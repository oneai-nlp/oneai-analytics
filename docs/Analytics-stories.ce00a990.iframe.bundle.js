"use strict";(self.webpackChunkoneai_analytics=self.webpackChunkoneai_analytics||[]).push([[125],{"./stories/Analytics.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Template:()=>Template,__namedExportsOrder:()=>__namedExportsOrder,default:()=>Analytics_stories});var react=__webpack_require__("./node_modules/react/index.js"),format=__webpack_require__("./node_modules/date-fns/esm/format/index.js");const CUSTOM_METADATA_KEY="item count",PAGE_SIZE=25;var externalInputs=__webpack_require__("./src/common/utils/externalInputs.ts");function getNodeText(node){return"Cluster"===node.type?node.data.cluster_phrase:"Phrase"===node.type?node.data.text:"Meta"===node.type?node.data.meta_value:node.data.original_text}function getNodeId(node){return("Cluster"===node.type?node.data.cluster_id:"Phrase"===node.type?node.data.phrase_id:"Meta"===node.type?node.data.meta_key+"$$"+node.data.meta_value:node.data.id).toString()}function getNodeDetails(node,collection){const currentNodeType=node?.type??"Collection";return{id:node?getNodeId(node):collection,type:currentNodeType}}const getNodeOriginalAndTranslatedText=node=>{if(!node)return{originalText:void 0,translatedText:void 0};if(["Cluster","Phrase","Item"].includes(node.type)){const cluster=node.data;return{originalText:cluster.item_original_text,translatedText:cluster.item_translated_text??cluster.item_original_text}}if("Meta"===node.type){const item=node.data;return{originalText:item.meta_value,translatedText:item.meta_value}}return{originalText:void 0,translatedText:void 0}};function utils_sum(numbers){return numbers.reduce(((partialSum,a)=>partialSum+a),0)}function uniqBy(arr,getKey){let seen=new Set;return arr.filter((item=>{let k=getKey(item);return!seen.has(k)&&seen.add(k)}))}function toLowerKeys(obj){return void 0===obj?{}:Object.keys(obj).reduce(((accumulator,key)=>(accumulator[key.toLowerCase()]=obj[key],accumulator)),{})}const numberToFixed=num=>Math.round(100*(num+Number.EPSILON))/100,customNumberToFixed=num=>{const str=Math.abs(num).toString(),[integer,_]=str.split(".");return integer.length<3?numberToFixed(parseFloat(num.toFixed(2))):integer.length<4?numberToFixed(parseFloat(num.toFixed(1))):parseFloat(num.toFixed(0))};function getNumberDescription(numIn){const num=customNumberToFixed(numIn),prefix=num<0?"-":"";let abbrev=["k","m","b","t"],strResult=num.toString(),result=Math.abs(num),decPlaces=strResult.length>3?1:2;decPlaces=Math.pow(10,decPlaces);for(let i=abbrev.length-1;i>=0;i--){let size=Math.pow(10,3*(i+1));if(size<=result){result=Math.round(result*decPlaces/size)/decPlaces,1e3===result&&i<abbrev.length-1&&(result=1,i++),strResult=result.toString()+abbrev[i];break}}return prefix+strResult}const objectToLowerCase=obj=>{const entries=Object.entries(obj);return Object.fromEntries(entries.map((([key,value])=>[key.toLowerCase(),value])))},skillsArray=["sentence","entity","enhance","highlight","keyword","summarize","emotion","article-topic","sentiment","extract-html","html-extract-text","html-extract-article","anonymize","embedding","clustering","action-item","business-entity","sales-insight","dialogue-segmentation","name","number","find","transcribe","translate","detect-language","debug","headline","subheading","skill-discovery","whisper-transcription","service-email-insight","pdf-extract-text","custom","fact-check","gpt","classify","collection-search","coda-query-classifier","social-toxicity","content-curation","subsentence","bizgpt","files-extract-text","query-rewriter"];var HomeIcon=__webpack_require__("./node_modules/@heroicons/react/20/solid/esm/HomeIcon.js"),XMarkIcon=__webpack_require__("./node_modules/@heroicons/react/20/solid/esm/XMarkIcon.js"),ArrowPathIcon=__webpack_require__("./node_modules/@heroicons/react/24/outline/esm/ArrowPathIcon.js"),EyeIcon=__webpack_require__("./node_modules/@heroicons/react/24/outline/esm/EyeIcon.js"),EyeSlashIcon=__webpack_require__("./node_modules/@heroicons/react/24/outline/esm/EyeSlashIcon.js"),LanguageIcon=__webpack_require__("./node_modules/@heroicons/react/24/outline/esm/LanguageIcon.js"),index_esm=__webpack_require__("./node_modules/react-resize-detector/build/index.esm.js"),index_es=__webpack_require__("./node_modules/react-tooltip/dist/index.es.js");function totalSumCalculation(metadataKeyValue,metadata,_,countersConfigurations,__){const counter=getMetadataKeyValueConfiguration(metadataKeyValue,countersConfigurations);return counter?{result:calculateSumItemsInMetadata(counter.members,counter.items,metadata),counter}:{counter,result:0}}function percentOfAllItemsCalculation(metadataKeyValue,metadata,_,countersConfigurations,totalItems){if(!metadataKeyValue)return{counter:null,result:0};const itemCounter=getMetadataKeyValueConfiguration(metadataKeyValue,countersConfigurations),keyCounter=getMetadataKeyValueConfiguration({key:CUSTOM_METADATA_KEY},countersConfigurations);if(!itemCounter||!keyCounter)return{counter:null,result:0};const itemCount=calculateSumItemsInMetadata(itemCounter.members,itemCounter.items,metadata),keyCount=calculateSumItemsInMetadata(keyCounter.members,keyCounter.items,metadata);let result;return result=metadataKeyValue.key===CUSTOM_METADATA_KEY?0===totalItems?0:itemCount/totalItems*100:0===keyCount?0:itemCount/keyCount*100,{result,counter:itemCounter??keyCounter,metadataKey:metadataKeyValue.key,value:metadataKeyValue.value}}function getMetadataKeyValueGroups(metadataKeyValue,countersConfigurations){return getCounterGroups(getMetadataKeyValueConfiguration(metadataKeyValue,countersConfigurations))}function getCounterGroups(counter){return counter?counter.items?.filter((group=>group.isGroup??!1))??[]:[]}function hasMultipleMembers(metadataKeyValue,countersConfigurations){const counter=getMetadataKeyValueConfiguration(metadataKeyValue,countersConfigurations);if(!counter)return!1;if(counter.isGroup)return!0;let sum=0;return counter.members?.forEach((member=>sum+=member.values?.length??2)),sum>1}function getMetadataKeyValueConfiguration(metadataKeyValue,countersConfigurations){if(!metadataKeyValue)return null;const keyConfig=objectToLowerCase(countersConfigurations)[metadataKeyValue.key.toLowerCase()];if(!keyConfig)return null;if(!metadataKeyValue.value)return keyConfig;const memberConfig=keyConfig.items?.find((group=>group.label?.toLowerCase()===metadataKeyValue.value?.toLowerCase()));return memberConfig&&memberConfig.display?memberConfig:keyConfig}function calculateSumItemsInMetadata(members,groups,metadata){return utils_sum(getValuesAndCounts(members,groups,metadata).map((({count})=>count)))}function getMaxItemValue(members,groups,metadata){const items=getValuesAndCounts(members,groups,metadata);return 0===items.length?{count:0}:items.reduce(((prev,current)=>prev.count>current.count?prev:current))}function getValuesAndCounts(members,groups,metadata){const lowerKeysMetadata=toLowerKeys(metadata),membersData=filterRelevantValues(members,lowerKeysMetadata);return membersData.length>0?membersData:filterRelevantValues(groups?.flatMap((group=>group.members??[]))??[],lowerKeysMetadata)}function filterRelevantValues(members,metadata){return members?.flatMap((member=>{const values=metadata[member.metadataName??""];return values?(void 0===member.values?values:values.filter((k=>member.values?.includes(k.value)))).map((({value,count})=>({metadata:member.metadataName,value,count}))):[]}))??[]}function getItemCounterConfiguration(metadata,value,countersConfigurations){if(!metadata||!value)return null;const counterConfig=countersConfigurations[metadata],valueCounterConfig=counterConfig.items?.find((group=>group.label===value));return valueCounterConfig&&valueCounterConfig.display?valueCounterConfig:null}var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function LabelDisplay({metadataKey,value,countersConfiguration,labelClicked,tooltip="",width,maxWidth="10ch",color}){const config=getMetadataKeyValueConfiguration({key:metadataKey,value},countersConfiguration);return(0,jsx_runtime.jsxs)("span",{"data-for":"global","data-tip":""!==tooltip?tooltip+": "+value:value,className:"flex items-center cursor-pointer text-gray-500 hover:text-gray-300",style:{color},onClick:()=>labelClicked(metadataKey,value),children:[config&&config.display&&null!==config.display.icon&&(0,jsx_runtime.jsx)("span",{className:"w-[1em] h-[1em] "+("green"===config.display.color?"text-emerald-400":"red"===config.display.color?"text-red-400":"text-gray-500 dark:text-gray-300"),children:config.display.icon}),(0,jsx_runtime.jsx)("span",{style:{width,maxWidth,marginLeft:"topic"===metadataKey?"-1px":"1px"},className:"italic truncate pr-1",children:value})]})}LabelDisplay.displayName="LabelDisplay";try{LabelDisplay.displayName="LabelDisplay",LabelDisplay.__docgenInfo={description:"",displayName:"LabelDisplay",props:{metadataKey:{defaultValue:null,description:"",name:"metadataKey",required:!0,type:{name:"string"}},value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"string"}},countersConfiguration:{defaultValue:null,description:"",name:"countersConfiguration",required:!0,type:{name:"CountersConfigurations"}},labelClicked:{defaultValue:null,description:"",name:"labelClicked",required:!0,type:{name:"(key: string, value: string) => void"}},tooltip:{defaultValue:{value:""},description:"",name:"tooltip",required:!1,type:{name:"string"}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"string"}},maxWidth:{defaultValue:{value:"10ch"},description:"",name:"maxWidth",required:!1,type:{name:"string"}},color:{defaultValue:null,description:"",name:"color",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/common/components/CountersLabels/LabelDisplay.tsx#LabelDisplay"]={docgenInfo:LabelDisplay.__docgenInfo,name:"LabelDisplay",path:"src/common/components/CountersLabels/LabelDisplay.tsx#LabelDisplay"})}catch(__react_docgen_typescript_loader_error){}var listbox=__webpack_require__("./node_modules/@headlessui/react/dist/components/listbox/listbox.js"),transition=__webpack_require__("./node_modules/@headlessui/react/dist/components/transitions/transition.js"),FunnelIcon=__webpack_require__("./node_modules/@heroicons/react/24/outline/esm/FunnelIcon.js"),ChevronUpDownIcon=__webpack_require__("./node_modules/@heroicons/react/24/outline/esm/ChevronUpDownIcon.js"),ChevronUpIcon=__webpack_require__("./node_modules/@heroicons/react/24/outline/esm/ChevronUpIcon.js"),ChevronDownIcon=__webpack_require__("./node_modules/@heroicons/react/24/outline/esm/ChevronDownIcon.js");function LabelsFiltersSelect({selectedLabels,labelFilterDeleted,countersConfigurations,selectedMetadataKeyValueChange,filterOnlySkills}){const[position,setPosition]=react.useState(!1),ref=(0,react.useRef)(null);return(0,jsx_runtime.jsx)(listbox.R,{children:(0,jsx_runtime.jsxs)("div",{className:"relative",children:[(0,jsx_runtime.jsxs)(listbox.R.Button,{className:"relative rounded-lg  py-2 pl-3 pr-10 text-left focus:outline-none sm:text-sm",onClick:()=>{"undefined"!=typeof window&&setTimeout((()=>{if(ref.current){ref.current.getBoundingClientRect().bottom>=window.innerHeight?setPosition(!0):setPosition(!1)}}),100)},children:[(0,jsx_runtime.jsx)("span",{className:"block truncate lowercase first-letter:uppercase text-black dark:text-white !text-xl",style:{width:"1em",height:"1em"},children:(0,jsx_runtime.jsx)(FunnelIcon.Z,{})}),(0,jsx_runtime.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,jsx_runtime.jsx)(ChevronUpDownIcon.Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),(0,jsx_runtime.jsx)(transition.u,{as:react.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,jsx_runtime.jsx)(listbox.R.Options,{ref,className:`fixed ${position?"-mt-[200px]":"mt-3"} z-10 max-h-60 scrollbar-thin scrollbar-thumb-[#747189] dark:scrollbar-track-[#272533] \n          overflow-y-scroll scrollbar-thumb-rounded-full scrollbar-track-rounded-full rounded-md bg-white\n          dark:bg-[#272533] py-1 text-base shadow-lg ring-1 ring-gray-500 dark:ring-black ring-opacity-5 focus:outline-none sm:text-sm`,children:uniqBy(Object.keys(countersConfigurations).sort(((a,b)=>a<b?-1:a>b?1:0)),(key=>key)).filter((meta=>filterOnlySkills?(countersConfigurations[meta]?.items?.length??0)>0&&skillsArray.includes(meta):(countersConfigurations[meta]?.items?.length??0)>0)).map(((key,i)=>(0,jsx_runtime.jsx)(CascadedOption,{countersConfigurations,optionName:key,index:i,selected:selectedLabels??[],labelFilterDeleted,labelClicked:selectedMetadataKeyValueChange},i)))})})]})})}function CascadedOption({countersConfigurations,optionName,index,selected,labelClicked,labelFilterDeleted}){const keySelected=selected.some((s=>s.key===optionName)),[opened,setOpened]=(0,react.useState)(keySelected),configData=countersConfigurations[optionName];return(0,jsx_runtime.jsxs)(react.Fragment,{children:[configData.items&&configData.items.length>0?(0,jsx_runtime.jsxs)("button",{type:"button",className:"ml-auto w-full pr-3 flex items-center justify-between hover:bg-gray-400 hover:dark:bg-[#444154]",onClick:e=>{e.preventDefault(),setOpened(!opened)},children:[(0,jsx_runtime.jsx)(MetadataTitle,{label:optionName,setOpened},optionName),opened?(0,jsx_runtime.jsx)(ChevronUpIcon.Z,{className:"h-4 w-4 text-gray-500 dark:text-gray-300"}):(0,jsx_runtime.jsx)(ChevronDownIcon.Z,{className:"h-4 w-4 text-gray-500 dark:text-gray-300"}),(0,jsx_runtime.jsx)("span",{className:"sr-only",children:"Open or Close metadata"})]}):null,opened?uniqBy(configData.items??[],(group=>group.label)).map(((group,i)=>(0,jsx_runtime.jsx)(DropdownOption,{label:group.label??"",value:{key:optionName,value:group.label},selected:selected.some((keyVal=>keyVal.key===optionName&&keyVal.value===group.label)),labelFilters:selected,labelClicked,labelFilterDeleted,pl:2},optionName+group.label+i.toString()))):null]},index)}function MetadataTitle({label,setOpened}){return(0,jsx_runtime.jsx)(listbox.R.Option,{style:{paddingLeft:"1rem"},className:"relative select-none py-2 pr-4 cursor-pointer",onClick:e=>{e.preventDefault(),setOpened(!0)},value:label,children:(0,jsx_runtime.jsx)("span",{className:"w-full flex",children:(0,jsx_runtime.jsx)("div",{className:"flex items-center",children:(0,jsx_runtime.jsx)("label",{className:"text-sm ml-2 font-medium text-gray-900 dark:text-gray-300 block truncate lowercase first-letter:uppercase cursor-pointer",children:label})})})})}function DropdownOption({label,value,selected,labelFilters,labelClicked,labelFilterDeleted,pl=1}){return(0,jsx_runtime.jsx)(listbox.R.Option,{style:{paddingLeft:pl+"rem"},className:({active})=>"relative cursor-default select-none py-2 pr-4 "+(active?"bg-gray-400 dark:bg-[#444154] text-white":"text-gray-300 dark:text-[#747189]"),onClick:()=>{if(selected){const index=labelFilters.findIndex((s=>s.key===value.key&&s.value===value.value));index>=0&&labelFilterDeleted(index)}else labelClicked(value)},value,children:(0,jsx_runtime.jsx)("span",{className:"w-full flex",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[(0,jsx_runtime.jsx)("input",{checked:selected,onChange:()=>{},type:"checkbox",className:"w-4 h-4 text-[#4D4DFE] bg-gray-100 border-gray-300 focus:ring-[#4D4DFE] dark:ring-offset-gray-800 focus:ring-2 dark:bg-[#322F46] dark:border-[#322F46]"}),(0,jsx_runtime.jsx)("label",{className:"text-sm ml-2 font-medium text-gray-900 dark:text-gray-300 block truncate lowercase first-letter:uppercase "+(selected?"font-medium":"font-normal"),children:label})]})})})}LabelsFiltersSelect.displayName="LabelsFiltersSelect",CascadedOption.displayName="CascadedOption",MetadataTitle.displayName="MetadataTitle",DropdownOption.displayName="DropdownOption";try{LabelsFiltersSelect.displayName="LabelsFiltersSelect",LabelsFiltersSelect.__docgenInfo={description:"",displayName:"LabelsFiltersSelect",props:{selectedLabels:{defaultValue:null,description:"",name:"selectedLabels",required:!0,type:{name:"MetadataKeyValue[]"}},labelFilterDeleted:{defaultValue:null,description:"",name:"labelFilterDeleted",required:!0,type:{name:"(labelIndex: number) => void"}},selectedMetadataKeyValueChange:{defaultValue:null,description:"",name:"selectedMetadataKeyValueChange",required:!0,type:{name:"(newMetadataKeyValue: MetadataKeyValue) => void"}},countersConfigurations:{defaultValue:null,description:"",name:"countersConfigurations",required:!0,type:{name:"CountersConfigurations"}},filterOnlySkills:{defaultValue:null,description:"",name:"filterOnlySkills",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/common/components/CountersLabels/LabelsFiltersSelect.tsx#LabelsFiltersSelect"]={docgenInfo:LabelsFiltersSelect.__docgenInfo,name:"LabelsFiltersSelect",path:"src/common/components/CountersLabels/LabelsFiltersSelect.tsx#LabelsFiltersSelect"})}catch(__react_docgen_typescript_loader_error){}function SingleSelect({options,selectedLabel,onSelect}){return(0,jsx_runtime.jsx)(listbox.R,{children:(0,jsx_runtime.jsxs)("div",{className:"relative",children:[(0,jsx_runtime.jsxs)(listbox.R.Button,{className:"relative rounded-lg text-left focus:outline-none text-sm flex items-center",children:[(0,jsx_runtime.jsx)("span",{className:"text-[#111111] dark:text-gray-300 text-sm mr-1",children:selectedLabel}),(0,jsx_runtime.jsx)("span",{children:(0,jsx_runtime.jsx)(ChevronDownIcon.Z,{className:"h-4 w-4 text-gray-500 dark:text-gray-200","aria-hidden":"true"})})]}),(0,jsx_runtime.jsx)(transition.u,{as:react.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,jsx_runtime.jsx)(listbox.R.Options,{className:"fixed mt-1 z-10 p-1 max-h-60 scrollbar-thin scrollbar-thumb-[#747189] scrollbar-track-[#272533] overflow-y-scroll scrollbar-thumb-rounded-full scrollbar-track-rounded-full rounded-md bg-gray-200 dark:bg-[#272533] py-1 text-base shadow-lg ring-1 ring-gray-500 dark:ring-black ring-opacity-5 focus:outline-none sm:text-sm",children:options.map(((key,i)=>(0,jsx_runtime.jsx)(SingleSelect_DropdownOption,{label:key,value:key,selected:selectedLabel===key,labelClicked:onSelect},i)))})})]})})}function SingleSelect_DropdownOption({label,value,selected,labelClicked}){return(0,jsx_runtime.jsx)(listbox.R.Option,{className:({active})=>"relative cursor-default select-none py-2 pr-4 "+(active?"bg-gray-400 dark:bg-[#444154] text-white":"text-gray-300 dark:text-[#747189]"),onClick:()=>labelClicked(value),value,children:(0,jsx_runtime.jsx)("span",{className:"w-full flex",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[(0,jsx_runtime.jsx)("input",{checked:selected,onChange:()=>{},type:"radio",className:"w-4 h-4 text-[#4D4DFE] bg-gray-100 border-gray-300 focus:ring-[#4D4DFE] dark:ring-offset-gray-800 focus:ring-2 dark:bg-[#322F46] dark:border-[#322F46]"}),(0,jsx_runtime.jsx)("label",{className:"text-sm ml-2 font-medium text-gray-900 dark:text-gray-300 block truncate lowercase first-letter:uppercase "+(selected?"font-medium":"font-normal"),children:label})]})})})}SingleSelect.displayName="SingleSelect",SingleSelect_DropdownOption.displayName="DropdownOption";try{SingleSelect.displayName="SingleSelect",SingleSelect.__docgenInfo={description:"",displayName:"SingleSelect",props:{options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"string[]"}},selectedLabel:{defaultValue:null,description:"",name:"selectedLabel",required:!0,type:{name:"string"}},onSelect:{defaultValue:null,description:"",name:"onSelect",required:!0,type:{name:"(selectedLabel: string) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/common/components/CountersLabels/SingleSelect.tsx#SingleSelect"]={docgenInfo:SingleSelect.__docgenInfo,name:"SingleSelect",path:"src/common/components/CountersLabels/SingleSelect.tsx#SingleSelect"})}catch(__react_docgen_typescript_loader_error){}var ArrowUpIcon=__webpack_require__("./node_modules/@heroicons/react/20/solid/esm/ArrowUpIcon.js"),ArrowDownIcon=__webpack_require__("./node_modules/@heroicons/react/20/solid/esm/ArrowDownIcon.js"),ArrowsUpDownIcon=__webpack_require__("./node_modules/@heroicons/react/20/solid/esm/ArrowsUpDownIcon.js");const numberFormatter=new Intl.NumberFormat("en-US");function getMetadataKeyValueDisplay(metadataKeyValue){return metadataKeyValue.value?`${metadataKeyValue.key}.${metadataKeyValue.value}`:metadataKeyValue.key}function getBackgroundColorLayers(colorAxis,metadata,trends,countersConfiguration,totalItems,totalUniqueItemsStats,uniqueItemsStats,uniquePropertyName){return function groupCounters(counters,countersConfiguration){return counters.reduce(((groups,counter)=>{const index=groups.findIndex((group=>group.length>0&&function areCountersCanBeGrouped(firstCounter,secondCounter,countersConfiguration){return!!(firstCounter.metadataKeyValue&&secondCounter&&secondCounter.metadataKeyValue)&&(firstCounter.calculationConfiguration.name===secondCounter.calculationConfiguration.name&&function areKeyValuesSameLevel(firstKeyValue,secondKeyValue,countersConfiguration){if(firstKeyValue.key!==secondKeyValue.key)return!1;const firstKeyValueHasGroups=getMetadataKeyValueGroups(firstKeyValue,countersConfiguration).length>0,secondKeyValueHasGroups=getMetadataKeyValueGroups(secondKeyValue,countersConfiguration).length>0;if(firstKeyValueHasGroups!==secondKeyValueHasGroups)return!1;const firstKeyValueHasMultipleMembers=hasMultipleMembers(firstKeyValue,countersConfiguration),secondKeyValueHasMultipleMembers=hasMultipleMembers(secondKeyValue,countersConfiguration);return firstKeyValueHasMultipleMembers===secondKeyValueHasMultipleMembers}(firstCounter.metadataKeyValue,secondCounter.metadataKeyValue,countersConfiguration))}(counter,group.at(0),countersConfiguration)));return-1!==index?groups[index].push(counter):groups.push([counter]),groups}),[])}(colorAxis,countersConfiguration).map((countersGroup=>{const groups=countersGroup.map((counter=>counter.calculationConfiguration.calculate(counter.metadataKeyValue,metadata,trends,countersConfiguration,totalItems,totalUniqueItemsStats,uniqueItemsStats,uniquePropertyName)));if(!groups.some((group=>group.result&&group.result>0)))return"";let backgroundString="",totalPercentage=0;return groups.forEach((group=>{backgroundString+=`,${group.counter?.display?.color??"rgba(255,0,0,0)"} ${totalPercentage}% ${totalPercentage+group.result}%`,totalPercentage+=group.result})),backgroundString=`${backgroundString},rgba(255,0,0,0) ${totalPercentage}% ${100-totalPercentage}%`,`linear-gradient(90deg${backgroundString})`})).filter((str=>""!==str))}function CounterDisplay({counter,metadata,countersConfiguration,trends,totalItems,width,maxWidth="6ch",totalUniqueItemsStats,uniqueItemsStats,uniquePropertyName}){const metadataKeyValue=counter.metadataKeyValue;if(!metadataKeyValue)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});const displayResult=counter.calculationConfiguration.calculate(metadataKeyValue,metadata,trends,countersConfiguration,totalItems,totalUniqueItemsStats,uniqueItemsStats,uniquePropertyName);return displayResult.counter?(0,jsx_runtime.jsxs)("span",{"data-tip":`${getMetadataKeyValueDisplay(metadataKeyValue)} - ${counter.calculationConfiguration.name}`+getMetadataValueTitle(displayResult.metadataKey,displayResult.value)+" - "+numberFormatter.format(customNumberToFixed(displayResult.result)),"data-for":"global",className:"flex items-center text-sm "+("trend"!==counter.calculationConfiguration.type&&displayResult.result<1?"text-gray-500 dark:text-gray-300":displayResult.counter.display?"green"===displayResult.counter.display.color?"text-emerald-400":"red"===displayResult.counter.display.color?"text-red-400":"text-gray-500 dark:text-gray-300":"text-gray-500 dark:text-gray-300"),children:["trend"===counter.calculationConfiguration.type&&displayResult.result>0?(0,jsx_runtime.jsx)("span",{className:"text-emerald-400",style:{width:"1em",height:"1em"},children:(0,jsx_runtime.jsx)(ArrowUpIcon.Z,{})}):"trend"===counter.calculationConfiguration.type&&displayResult.result<0?(0,jsx_runtime.jsx)("span",{className:"text-red-400",style:{width:"1em",height:"1em"},children:(0,jsx_runtime.jsx)(ArrowDownIcon.Z,{})}):"trend"===counter.calculationConfiguration.type&&(0,jsx_runtime.jsx)("span",{className:"text-gray-300",style:{width:"1em",height:"1em"},children:(0,jsx_runtime.jsx)(ArrowsUpDownIcon.Z,{})}),displayResult.counter.display&&null!==displayResult.counter.display.icon&&(0,jsx_runtime.jsx)("span",{style:{width:"1em",height:"1em"},children:displayResult.counter.display.icon}),(0,jsx_runtime.jsxs)("span",{className:""+("trend"===counter.calculationConfiguration.type?displayResult.result>0?"text-emerald-400":displayResult.result<0?"text-red-400":"text-gray-500 dark:text-gray-300":""),style:{width,maxWidth},children:[getNumberDescription(displayResult.result),"percentage"===counter.calculationConfiguration.type||"trend"===counter.calculationConfiguration.type?"%":null]})]}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})}function getMetadataValueTitle(metadata,value){return metadata?value?`(${metadata}.${value})`:`(${metadata})`:value?`(${value})`:""}CounterDisplay.displayName="CounterDisplay";try{CounterDisplay.displayName="CounterDisplay",CounterDisplay.__docgenInfo={description:"",displayName:"CounterDisplay",props:{counter:{defaultValue:null,description:"",name:"counter",required:!0,type:{name:"CounterType"}},metadata:{defaultValue:null,description:"",name:"metadata",required:!0,type:{name:"MetaData"}},countersConfiguration:{defaultValue:null,description:"",name:"countersConfiguration",required:!0,type:{name:"CountersConfigurations"}},trends:{defaultValue:null,description:"",name:"trends",required:!0,type:{name:"Trend[]"}},totalItems:{defaultValue:null,description:"",name:"totalItems",required:!0,type:{name:"number"}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"string"}},maxWidth:{defaultValue:{value:"6ch"},description:"",name:"maxWidth",required:!1,type:{name:"string"}},totalUniqueItemsStats:{defaultValue:null,description:"",name:"totalUniqueItemsStats",required:!1,type:{name:"UniqueItemsStats"}},uniqueItemsStats:{defaultValue:null,description:"",name:"uniqueItemsStats",required:!1,type:{name:"UniqueItemsStats"}},uniquePropertyName:{defaultValue:null,description:"",name:"uniquePropertyName",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/common/components/CountersLabels/CounterDisplay.tsx#CounterDisplay"]={docgenInfo:CounterDisplay.__docgenInfo,name:"CounterDisplay",path:"src/common/components/CountersLabels/CounterDisplay.tsx#CounterDisplay"})}catch(__react_docgen_typescript_loader_error){}function MaxLabelDisplay({metadataKey,metadata,countersConfiguration,labelClicked,width,maxWidth}){const lowerKeysMetadata=toLowerKeys(metadata),meta=lowerKeysMetadata[metadataKey.toLowerCase()]?.reduce(((prev,current)=>prev.count>current.count?prev:current));return meta?(0,jsx_runtime.jsx)(LabelDisplay,{metadataKey,value:meta.value,countersConfiguration,labelClicked,width,maxWidth}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})}MaxLabelDisplay.displayName="MaxLabelDisplay";try{MaxLabelDisplay.displayName="MaxLabelDisplay",MaxLabelDisplay.__docgenInfo={description:"",displayName:"MaxLabelDisplay",props:{metadataKey:{defaultValue:null,description:"",name:"metadataKey",required:!0,type:{name:"string"}},metadata:{defaultValue:null,description:"",name:"metadata",required:!0,type:{name:"MetaData"}},countersConfiguration:{defaultValue:null,description:"",name:"countersConfiguration",required:!0,type:{name:"CountersConfigurations"}},labelClicked:{defaultValue:null,description:"",name:"labelClicked",required:!0,type:{name:"(key: string, value: string) => void"}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"string"}},maxWidth:{defaultValue:null,description:"",name:"maxWidth",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/common/components/CountersLabels/MaxLabelDisplay.tsx#MaxLabelDisplay"]={docgenInfo:MaxLabelDisplay.__docgenInfo,name:"MaxLabelDisplay",path:"src/common/components/CountersLabels/MaxLabelDisplay.tsx#MaxLabelDisplay"})}catch(__react_docgen_typescript_loader_error){}function CountersLabelsDisplay({counters,labels,metadata,countersConfiguration,trends,labelClicked,counterWidth,counterMaxWidth,labelWidth,labelMaxWidth,totalItems,totalUniqueItemsStats,uniqueItemsStats,uniquePropertyName}){return(0,jsx_runtime.jsxs)("span",{className:"truncate flex items-center",children:[counters.filter((counter=>null!==counter.metadataKeyValue)).map(((counter,i)=>(0,jsx_runtime.jsx)("div",{className:"mr-2",children:(0,jsx_runtime.jsx)(CounterDisplay,{counter,countersConfiguration,metadata,trends,width:counterWidth,maxWidth:counterMaxWidth,totalItems,totalUniqueItemsStats,uniqueItemsStats,uniquePropertyName})},i))),labels.map(((label,i)=>(0,jsx_runtime.jsx)("div",{className:"mr-1",children:(0,jsx_runtime.jsx)(MaxLabelDisplay,{countersConfiguration,metadataKey:label,labelClicked,metadata,width:labelWidth,maxWidth:labelMaxWidth})},i)))]})}CountersLabelsDisplay.displayName="CountersLabelsDisplay";try{CountersLabelsDisplay.displayName="CountersLabelsDisplay",CountersLabelsDisplay.__docgenInfo={description:"",displayName:"CountersLabelsDisplay",props:{counters:{defaultValue:null,description:"",name:"counters",required:!0,type:{name:"CounterType[]"}},labels:{defaultValue:null,description:"",name:"labels",required:!0,type:{name:"string[]"}},metadata:{defaultValue:null,description:"",name:"metadata",required:!0,type:{name:"MetaData"}},countersConfiguration:{defaultValue:null,description:"",name:"countersConfiguration",required:!0,type:{name:"CountersConfigurations"}},trends:{defaultValue:null,description:"",name:"trends",required:!0,type:{name:"Trend[]"}},labelClicked:{defaultValue:null,description:"",name:"labelClicked",required:!0,type:{name:"(key: string, value: string) => void"}},totalItems:{defaultValue:null,description:"",name:"totalItems",required:!0,type:{name:"number"}},counterWidth:{defaultValue:null,description:"",name:"counterWidth",required:!1,type:{name:"string"}},counterMaxWidth:{defaultValue:null,description:"",name:"counterMaxWidth",required:!1,type:{name:"string"}},labelWidth:{defaultValue:null,description:"",name:"labelWidth",required:!1,type:{name:"string"}},labelMaxWidth:{defaultValue:null,description:"",name:"labelMaxWidth",required:!1,type:{name:"string"}},totalUniqueItemsStats:{defaultValue:null,description:"",name:"totalUniqueItemsStats",required:!1,type:{name:"UniqueItemsStats"}},uniqueItemsStats:{defaultValue:null,description:"",name:"uniqueItemsStats",required:!1,type:{name:"UniqueItemsStats"}},uniquePropertyName:{defaultValue:null,description:"",name:"uniquePropertyName",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/common/components/CountersLabelsDisplay.tsx#CountersLabelsDisplay"]={docgenInfo:CountersLabelsDisplay.__docgenInfo,name:"CountersLabelsDisplay",path:"src/common/components/CountersLabelsDisplay.tsx#CountersLabelsDisplay"})}catch(__react_docgen_typescript_loader_error){}var popover=__webpack_require__("./node_modules/@headlessui/react/dist/components/popover/popover.js"),esm_ChevronDownIcon=__webpack_require__("./node_modules/@heroicons/react/20/solid/esm/ChevronDownIcon.js"),esm_ChevronUpDownIcon=__webpack_require__("./node_modules/@heroicons/react/20/solid/esm/ChevronUpDownIcon.js"),esm_ChevronUpIcon=__webpack_require__("./node_modules/@heroicons/react/20/solid/esm/ChevronUpIcon.js");function DropdownOption_DropdownOption({label,value,pl=1}){return(0,jsx_runtime.jsx)(listbox.R.Option,{style:{paddingLeft:pl+"rem"},className:({active})=>"relative cursor-default select-none py-2 pr-4 "+(active?"bg-gray-400 dark:bg-[#444154] text-white":"text-gray-300 dark:text-[#747189]"),value,children:({selected})=>(0,jsx_runtime.jsx)("span",{className:"w-full flex",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[(0,jsx_runtime.jsx)("input",{checked:selected,onChange:()=>{},type:"radio",className:"w-4 h-4 text-[#4D4DFE] bg-gray-100 border-gray-300 focus:ring-[#4D4DFE] dark:ring-offset-gray-800 focus:ring-2 dark:bg-[#322F46] dark:border-[#322F46]"}),(0,jsx_runtime.jsx)("label",{className:"text-sm ml-2 font-medium text-gray-900 dark:text-gray-300 block truncate lowercase first-letter:uppercase "+(selected?"font-medium":"font-normal"),children:label})]})})})}DropdownOption_DropdownOption.displayName="DropdownOption";try{DropdownOption_DropdownOption.displayName="DropdownOption",DropdownOption_DropdownOption.__docgenInfo={description:"",displayName:"DropdownOption",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"string | MetadataKeyValue | CalculationConfiguration"}},pl:{defaultValue:{value:"1"},description:"",name:"pl",required:!1,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/common/components/CountersLabels/DropdownOption.tsx#DropdownOption"]={docgenInfo:DropdownOption_DropdownOption.__docgenInfo,name:"DropdownOption",path:"src/common/components/CountersLabels/DropdownOption.tsx#DropdownOption"})}catch(__react_docgen_typescript_loader_error){}function KeyValueSingleSelect({metadataKeyValue,countersConfigurations,selectedMetadataKeyValueChange,placeholder}){return(0,jsx_runtime.jsx)(listbox.R,{value:metadataKeyValue,onChange:selectedMetadataKeyValueChange,by:(a,b)=>a?.key===b?.key&&a?.value===b?.value,children:(0,jsx_runtime.jsxs)("div",{className:"relative",children:[(0,jsx_runtime.jsxs)(listbox.R.Button,{className:"relative rounded-lg bg-gray-200 dark:bg-[#272535] py-2 pl-3 pr-10 text-left focus:outline-none focus-visible:border-indigo-500 focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75 focus-visible:ring-offset-2 focus-visible:ring-offset-orange-300 sm:text-sm",children:[(0,jsx_runtime.jsx)("span",{className:"block truncate lowercase first-letter:uppercase text-gray-700 dark:text-white",children:metadataKeyValue?getMetadataKeyValueDisplay(metadataKeyValue):placeholder}),(0,jsx_runtime.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,jsx_runtime.jsx)(esm_ChevronUpDownIcon.Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),(0,jsx_runtime.jsx)(transition.u,{as:react.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,jsx_runtime.jsx)(listbox.R.Options,{className:"fixed mt-1 z-10 max-h-60 scrollbar-thin scrollbar-thumb-[#747189] scrollbar-track-[#272533] overflow-y-scroll scrollbar-thumb-rounded-full scrollbar-track-rounded-full rounded-md bg-gray-200 dark:bg-[#272533] py-1 text-base shadow-lg ring-1 ring-gray-500 dark:ring-black ring-opacity-5 focus:outline-none sm:text-sm",children:uniqBy(Object.keys(countersConfigurations).sort(((a,b)=>a<b?-1:a>b?1:0)),(key=>key)).map(((key,i)=>(0,jsx_runtime.jsx)(KeyValueSingleSelect_CascadedOption,{countersConfigurations,optionName:key,index:i,selected:(metadataKeyValue?.key??"")===key&&void 0!==metadataKeyValue?.value},i)))})})]})})}function KeyValueSingleSelect_CascadedOption({countersConfigurations,optionName,index,selected}){const[opened,setOpened]=(0,react.useState)(selected),configData=countersConfigurations[optionName];return(0,jsx_runtime.jsxs)(react.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"w-full flex",children:[(0,jsx_runtime.jsx)(DropdownOption_DropdownOption,{label:optionName,value:{key:optionName}},optionName),configData.items&&configData.items.length>0&&(0,jsx_runtime.jsxs)("button",{type:"button",className:"ml-auto mr-3",onClick:()=>setOpened((opened=>!opened)),children:[opened?(0,jsx_runtime.jsx)(esm_ChevronUpIcon.Z,{className:"h-4 w-4 text-gray-500 dark:text-gray-300 "}):(0,jsx_runtime.jsx)(esm_ChevronDownIcon.Z,{className:"h-4 w-4 text-gray-500 dark:text-gray-300 "}),(0,jsx_runtime.jsx)("span",{className:"sr-only",children:"Open or Close metadata"})]})]}),opened&&uniqBy(configData.items??[],(group=>group.label)).map(((group,i)=>(0,jsx_runtime.jsx)(DropdownOption_DropdownOption,{label:group.label??"",value:{key:optionName,value:group.label},pl:2},optionName+group.label+i.toString())))]},index)}KeyValueSingleSelect.displayName="KeyValueSingleSelect",KeyValueSingleSelect_CascadedOption.displayName="CascadedOption";try{KeyValueSingleSelect.displayName="KeyValueSingleSelect",KeyValueSingleSelect.__docgenInfo={description:"",displayName:"KeyValueSingleSelect",props:{metadataKeyValue:{defaultValue:null,description:"",name:"metadataKeyValue",required:!0,type:{name:"MetadataKeyValue | null"}},selectedMetadataKeyValueChange:{defaultValue:null,description:"",name:"selectedMetadataKeyValueChange",required:!0,type:{name:"(newMetadataKeyValue: MetadataKeyValue) => void"}},countersConfigurations:{defaultValue:null,description:"",name:"countersConfigurations",required:!0,type:{name:"CountersConfigurations"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/common/components/CountersLabels/KeyValueSingleSelect.tsx#KeyValueSingleSelect"]={docgenInfo:KeyValueSingleSelect.__docgenInfo,name:"KeyValueSingleSelect",path:"src/common/components/CountersLabels/KeyValueSingleSelect.tsx#KeyValueSingleSelect"})}catch(__react_docgen_typescript_loader_error){}const topValuePercentCalculationName="Top value %",topGroupPercentCalculationName="Top group %",totalSumCalculationConfiguration={name:"Total SUM",hasGroups:!1,hasMultipleMembers:!1,type:"number",calculate:totalSumCalculation},topValueCalculationConfiguration={name:"Top value total sum",hasGroups:!1,hasMultipleMembers:!0,type:"number",calculate:function topValueCalculation(metadataKeyValue,metadata,_,countersConfigurations,__){const counter=getMetadataKeyValueConfiguration(metadataKeyValue,countersConfigurations);if(!counter)return{counter,result:0};const maxItem=getMaxItemValue(counter.members,counter.items,metadata);return{result:maxItem.count,counter:getItemCounterConfiguration(maxItem.metadata,maxItem.value,countersConfigurations)??counter,metadataKey:maxItem.metadata,value:maxItem.value}}},topValuePercentCalculationConfiguration={name:topValuePercentCalculationName,hasGroups:!1,hasMultipleMembers:!0,type:"percentage",calculate:function topValuePercentCalculation(metadataKeyValue,metadata,_,countersConfigurations,__){const counter=getMetadataKeyValueConfiguration(metadataKeyValue,countersConfigurations);if(!counter)return{counter,result:0};const max=getMaxItemValue(counter.members,counter.items,metadata),sum=calculateSumItemsInMetadata(counter.members,counter.items,metadata);return{result:0===sum?0:max.count/sum*100,counter:getItemCounterConfiguration(max.metadata,max.value,countersConfigurations)??counter,metadataKey:max.metadata,value:max.value}}},topGroupCalculationConfiguration={name:"Top group total",hasGroups:!0,hasMultipleMembers:!1,type:"number",calculate:function topGroupCalculation(metadataKeyValue,metadata,_,countersConfigurations,__){const counter=getMetadataKeyValueConfiguration(metadataKeyValue,countersConfigurations),groups=getCounterGroups(counter);if(0===groups.length)return{counter,result:0};const sums=groups.map((group=>calculateSumItemsInMetadata(group.members,[],metadata))),max=Math.max(...sums),maxGroup=groups[sums.indexOf(max)];return{result:max,counter:max>0?maxGroup??counter:counter,metadataKey:maxGroup.label,value:void 0}}},topGroupPercentCalculationConfiguration={name:topGroupPercentCalculationName,hasGroups:!0,hasMultipleMembers:!1,type:"percentage",calculate:function topGroupPercentCalculation(metadataKeyValue,metadata,_,countersConfigurations,__){const counter=getMetadataKeyValueConfiguration(metadataKeyValue,countersConfigurations),groups=getCounterGroups(counter);if(!counter||0===groups.length)return{counter,result:0};const sums=groups.map((group=>calculateSumItemsInMetadata(group.members,[],metadata))),max=Math.max(...sums),maxGroup=groups[sums.indexOf(max)],groupsSum=utils_sum(sums);return{result:0===groupsSum?0:max/groupsSum*100,counter:max>0?maxGroup??counter:counter,metadataKey:maxGroup.label,value:void 0}}},percentOfItemsCalculationConfiguration={name:"% of items",hasGroups:!1,hasMultipleMembers:!1,type:"percentage",calculate:function percentOfItemsCalculation(metadataKeyValue,metadata,_,countersConfigurations,__){if(!metadataKeyValue)return{counter:null,result:0};const itemCounter=getMetadataKeyValueConfiguration(metadataKeyValue,countersConfigurations),keyCounter=getMetadataKeyValueConfiguration({key:metadataKeyValue.key},countersConfigurations);if(!itemCounter||!keyCounter)return{counter:null,result:0};const itemCount=calculateSumItemsInMetadata(itemCounter.members,itemCounter.items,metadata),keyCount=calculateSumItemsInMetadata(keyCounter.members,keyCounter.items,metadata);return{result:0===keyCount?0:itemCount/keyCount*100,counter:itemCounter??keyCounter,metadataKey:metadataKeyValue.key,value:metadataKeyValue.value}}},percentOfAllItemsCalculationConfiguration={name:"% of all items",hasGroups:!1,hasMultipleMembers:!1,type:"percentage",calculate:percentOfAllItemsCalculation},trendCalculationConfiguration={name:"trend",hasGroups:!1,hasMultipleMembers:!1,type:"trend",calculate:function trendCalculation(metadataKeyValue,_,trends,countersConfigurations){if(!metadataKeyValue||trends.length<2)return{counter:null,result:0};const itemCounter=getMetadataKeyValueConfiguration(metadataKeyValue,countersConfigurations),keyCounter=getMetadataKeyValueConfiguration({key:metadataKeyValue.key},countersConfigurations);if(!itemCounter||!keyCounter)return{counter:null,result:0};const trendsCounts=trends.map((trend=>calculateSumItemsInMetadata(itemCounter.members,itemCounter.items,trend.metadata))),latestTrend=trendsCounts.at(0)??0,previousTrendsSum=utils_sum(trendsCounts.slice(1,trendsCounts.length));return{result:function percentageIncrease(previous,current){let percent;return percent=0!==current?0!==previous?(current-previous)/previous*100:100*current:100*-previous,Math.floor(percent)}(previousTrendsSum>0?previousTrendsSum/trendsCounts.length-1:0,latestTrend),counter:itemCounter??keyCounter,metadataKey:metadataKeyValue.key,value:metadataKeyValue.value}}},percentOfTotalUniqueItemsCalculationConfiguration={name:"% of all unique items",hasGroups:!1,hasMultipleMembers:!1,type:"percentage",calculate:function percentOfAllUniqueItemsCalculation(metadataKeyValue,metadata,trend,countersConfigurations,totalItems,totalUniqueItemsStats,_,uniquePropertyName){if(!uniquePropertyName)return percentOfAllItemsCalculation(metadataKeyValue,metadata,0,countersConfigurations,totalItems);if(!metadataKeyValue||!totalUniqueItemsStats||!uniquePropertyName)return{counter:null,result:0};const itemCounter=getMetadataKeyValueConfiguration(metadataKeyValue,countersConfigurations);if(!itemCounter)return{counter:null,result:0};const itemCount=calculateSumItemsInMetadata(itemCounter.members,itemCounter.items,metadata),keyCount=totalUniqueItemsStats.unique_values_count.find((uv=>uv.meta_key===uniquePropertyName))?.unique_values_count??0;return{result:0===keyCount?0:itemCount/keyCount*100,counter:itemCounter,metadataKey:metadataKeyValue.key,value:metadataKeyValue.value}}},totalUniqueItemsCalculationConfiguration={name:"Total unique items",hasGroups:!1,hasMultipleMembers:!1,type:"number",calculate:function totalUniqueItemsCalculation(metadataKeyValue,metadata,trend,countersConfigurations,totalItems,_,uniqueItemsStats,uniquePropertyName){if(!uniquePropertyName)return totalSumCalculation(metadataKeyValue,metadata,0,countersConfigurations);if(!metadataKeyValue||!uniqueItemsStats)return{counter:null,result:0};let itemCounter;return itemCounter=metadataKeyValue.key===CUSTOM_METADATA_KEY?getMetadataKeyValueConfiguration({key:uniquePropertyName},countersConfigurations):getMetadataKeyValueConfiguration(metadataKeyValue,countersConfigurations),itemCounter?{result:uniqueItemsStats.unique_values_count.find((uv=>uv.meta_key===(metadataKeyValue.key===CUSTOM_METADATA_KEY?uniquePropertyName:metadataKeyValue.key)))?.unique_values_count??0,counter:itemCounter,metadataKey:metadataKeyValue.key,value:metadataKeyValue.value}:{counter:null,result:0}}};function Counters({countersConfigurations,calculationsConfigurations,currentCounters,countersChanged,addCounterText,title}){return(0,jsx_runtime.jsxs)("div",{className:"w-full",children:[(0,jsx_runtime.jsx)("p",{className:"text-xl text-gray-500 dark:text-white mb-1",children:title}),(0,jsx_runtime.jsxs)("div",{className:"flex w-full flex-wrap items-center",children:[currentCounters.map(((addedCounter,i)=>(0,jsx_runtime.jsx)("div",{className:"ml-1 mb-1",children:(0,jsx_runtime.jsx)(Counter,{counterData:addedCounter,countersConfigurations,calculationsConfigurations,counterDeleted:()=>{return index=i,currentCounters.splice(index,1),void countersChanged([...currentCounters]);var index},counterChanged:counter=>{return updatedCounter=counter,currentCounters[i]=updatedCounter,void countersChanged([...currentCounters]);var updatedCounter}})},i))),(0,jsx_runtime.jsx)("div",{className:"ml-1",children:(0,jsx_runtime.jsx)(KeyValueSingleSelect,{metadataKeyValue:null,countersConfigurations,selectedMetadataKeyValueChange:newMetadataKeyValue=>{const allowedCalculations=getCalculationTypes(calculationsConfigurations,newMetadataKeyValue,countersConfigurations);countersChanged([...currentCounters,{metadataKeyValue:newMetadataKeyValue,calculationConfiguration:getDefaultCalculation(allowedCalculations)}])},placeholder:addCounterText})})]})]})}function Counter({counterData,countersConfigurations,calculationsConfigurations,counterDeleted,counterChanged}){return(0,jsx_runtime.jsx)("div",{className:"w-full",children:(0,jsx_runtime.jsxs)("div",{className:"flex bg-gray-200 dark:bg-[#272535] p-1 w-fit",children:[(0,jsx_runtime.jsx)(KeyValueSingleSelect,{metadataKeyValue:counterData.metadataKeyValue,countersConfigurations,selectedMetadataKeyValueChange:newMetadataKeyValue=>{const allowedCalculations=getCalculationTypes(calculationsConfigurations,newMetadataKeyValue,countersConfigurations);counterChanged({metadataKeyValue:newMetadataKeyValue,calculationConfiguration:allowedCalculations.some((calc=>calc.name===counterData.calculationConfiguration.name))?counterData.calculationConfiguration:getDefaultCalculation(allowedCalculations)})},placeholder:"Select"}),(0,jsx_runtime.jsx)(listbox.R,{value:counterData.calculationConfiguration,onChange:newCounter=>{counterChanged({metadataKeyValue:counterData.metadataKeyValue,calculationConfiguration:newCounter})},by:"name",children:(0,jsx_runtime.jsxs)("div",{className:"relative ml-1",children:[(0,jsx_runtime.jsxs)(listbox.R.Button,{className:"relative rounded-lg bg-gray-200 dark:bg-[#272535] py-2 pl-3 pr-10 text-left focus:outline-none focus-visible:border-indigo-500 focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75 focus-visible:ring-offset-2 focus-visible:ring-offset-orange-300 sm:text-sm",children:[(0,jsx_runtime.jsx)("span",{className:"block truncate lowercase first-letter:uppercase text-gray-700 dark:text-white",children:counterData.calculationConfiguration.name}),(0,jsx_runtime.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,jsx_runtime.jsx)(esm_ChevronUpDownIcon.Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),(0,jsx_runtime.jsx)(transition.u,{as:react.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,jsx_runtime.jsx)(listbox.R.Options,{className:"fixed mt-1 z-10 max-h-60 scrollbar-thin scrollbar-thumb-[#747189] scrollbar-track-[#272533] overflow-y-scroll scrollbar-thumb-rounded-full scrollbar-track-rounded-full rounded-md bg-gray-200 dark:bg-[#272533] py-1 text-base shadow-lg ring-1 ring-gray-500 dark:ring-black ring-opacity-5 focus:outline-none sm:text-sm",children:getCalculationTypes(calculationsConfigurations,counterData.metadataKeyValue,countersConfigurations).sort((function(a,b){const textA=a.name.toLowerCase(),textB=b.name.toLowerCase();return textA<textB?-1:textA>textB?1:0})).map((counter=>(0,jsx_runtime.jsx)(DropdownOption_DropdownOption,{label:counter.name,value:counter},counter.name)))})})]})}),(0,jsx_runtime.jsxs)("button",{type:"button",className:"ml-1",onClick:counterDeleted,children:[(0,jsx_runtime.jsx)(XMarkIcon.Z,{className:"h-4 w-4 text-gray-400 dark:text-gray-600 hover:scale-125 transition duration-100 ease-linear"}),(0,jsx_runtime.jsx)("span",{className:"sr-only",children:"Delete counter"})]})]})})}function getCalculationTypes(calculationTypes,selectedMetadataKeyValue,countersConfiguration){if(!selectedMetadataKeyValue)return calculationTypes.filter((calc=>!calc.hasGroups&&!calc.hasMultipleMembers));if(getMetadataKeyValueGroups(selectedMetadataKeyValue,countersConfiguration).length>0)return calculationTypes;return hasMultipleMembers(selectedMetadataKeyValue,countersConfiguration)?calculationTypes.filter((calc=>!calc.hasGroups)):calculationTypes.filter((calc=>!calc.hasGroups&&!calc.hasMultipleMembers))}function getDefaultCalculation(allowedCalculations){return allowedCalculations.find((calc=>calc.name===topGroupPercentCalculationName))??allowedCalculations.find((calc=>calc.name===topValuePercentCalculationName))??allowedCalculations[0]}Counters.displayName="Counters",Counter.displayName="Counter";try{Counters.displayName="Counters",Counters.__docgenInfo={description:"",displayName:"Counters",props:{countersConfigurations:{defaultValue:null,description:"",name:"countersConfigurations",required:!0,type:{name:"CountersConfigurations"}},calculationsConfigurations:{defaultValue:null,description:"",name:"calculationsConfigurations",required:!0,type:{name:"CalculationConfiguration[]"}},currentCounters:{defaultValue:null,description:"",name:"currentCounters",required:!0,type:{name:"CounterType[]"}},countersChanged:{defaultValue:null,description:"",name:"countersChanged",required:!0,type:{name:"(counters: CounterType[]) => void"}},addCounterText:{defaultValue:null,description:"",name:"addCounterText",required:!0,type:{name:"string"}},title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/common/components/CustomizeTab/Counters.tsx#Counters"]={docgenInfo:Counters.__docgenInfo,name:"Counters",path:"src/common/components/CustomizeTab/Counters.tsx#Counters"})}catch(__react_docgen_typescript_loader_error){}function Labels({currentLabels,labelsOptions,labelsChanged,title="Labels"}){const[selectedLabels,setSelectedLabels]=(0,react.useState)(currentLabels);return(0,jsx_runtime.jsxs)("div",{className:"w-full",children:[(0,jsx_runtime.jsx)("p",{className:"text-xl text-gray-500 dark:text-white mb-1",children:title}),(0,jsx_runtime.jsx)(listbox.R,{value:selectedLabels,onChange:newLabels=>{setSelectedLabels(newLabels),labelsChanged(newLabels)},multiple:!0,children:(0,jsx_runtime.jsxs)("div",{className:"relative",children:[(0,jsx_runtime.jsxs)(listbox.R.Button,{className:"relative rounded-lg bg-gray-200 dark:bg-[#272535] py-2 pl-3 pr-10 text-left shadow-md focus:outline-none focus-visible:border-indigo-500 focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75 focus-visible:ring-offset-2 focus-visible:ring-offset-orange-300 sm:text-sm",children:[(0,jsx_runtime.jsx)("span",{className:"block truncate lowercase first-letter:uppercase dark:text-white text-gray-700",children:0===selectedLabels.length?"Select":`${selectedLabels.length} labels selected`}),(0,jsx_runtime.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,jsx_runtime.jsx)(esm_ChevronUpDownIcon.Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),(0,jsx_runtime.jsx)(transition.u,{as:react.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,jsx_runtime.jsx)(listbox.R.Options,{className:"fixed mt-1 z-10 max-h-60 scrollbar-thin scrollbar-thumb-[#747189] scrollbar-track-[#272533] overflow-y-scroll scrollbar-thumb-rounded-full scrollbar-track-rounded-full rounded-md bg-gray-200 dark:bg-[#272533] py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm",children:uniqBy(labelsOptions,(key=>key)).map((key=>(0,jsx_runtime.jsx)(Labels_DropdownOption,{label:key,value:key},key)))})})]})})]})}function Labels_DropdownOption({label,value,pl=1}){return(0,jsx_runtime.jsx)(listbox.R.Option,{style:{paddingLeft:pl+"rem"},className:({active})=>"relative cursor-default select-none py-2 pr-4 "+(active?"bg-gray-400 dark:bg-[#444154] text-white":"text-gray-300 dark:text-[#747189]"),value,children:({selected})=>(0,jsx_runtime.jsx)("span",{className:"w-full flex",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[(0,jsx_runtime.jsx)("input",{checked:selected,onChange:()=>{},type:"checkbox",className:"w-4 h-4 text-[#4D4DFE] bg-gray-100 border-gray-300 focus:ring-[#4D4DFE] dark:ring-offset-gray-800 focus:ring-2 dark:bg-[#322F46] dark:border-[#322F46]"}),(0,jsx_runtime.jsx)("label",{className:"text-sm ml-2 font-medium text-gray-900 dark:text-gray-300 block truncate lowercase first-letter:uppercase "+(selected?"font-medium":"font-normal"),children:label})]})})})}Labels.displayName="Labels",Labels_DropdownOption.displayName="DropdownOption";try{Labels.displayName="Labels",Labels.__docgenInfo={description:"",displayName:"Labels",props:{currentLabels:{defaultValue:null,description:"",name:"currentLabels",required:!0,type:{name:"string[]"}},labelsOptions:{defaultValue:null,description:"",name:"labelsOptions",required:!0,type:{name:"string[]"}},labelsChanged:{defaultValue:null,description:"",name:"labelsChanged",required:!0,type:{name:"(labels: string[]) => void"}},title:{defaultValue:{value:"Labels"},description:"",name:"title",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/common/components/CustomizeTab/Labels.tsx#Labels"]={docgenInfo:Labels.__docgenInfo,name:"Labels",path:"src/common/components/CustomizeTab/Labels.tsx#Labels"})}catch(__react_docgen_typescript_loader_error){}function CustomizeTab({currentCounters,selectedLabels,countersConfigurations,calculationsConfigurations,labelsOptions,countersChanged,labelsChanged,currentColorsAxis,selectedSizeAxis,colorsAxisChanged,sizeAxisChanged}){const[position,setPosition]=react.useState(!1),ref=react.useRef(null),onClick=()=>{"undefined"!=typeof window&&setTimeout((()=>{if(ref.current){ref.current.getBoundingClientRect().bottom>=window.innerHeight?setPosition(!0):setPosition(!1)}}),100)};return(0,jsx_runtime.jsx)("div",{className:"max-w-sm",children:(0,jsx_runtime.jsx)(popover.J,{className:"relative",children:({open})=>(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(popover.J.Button,{onClick,className:`\n                ${open?"":"text-opacity-90"}\n                group inline-flex items-center rounded-md px-3 py-2 text-base font-medium text-gray-500 dark:text-black hover:text-opacity-100 focus:outline-none `,children:[(0,jsx_runtime.jsx)("span",{className:"text-[#747189] font-normal",children:"Customize"}),(0,jsx_runtime.jsx)(esm_ChevronDownIcon.Z,{className:(open?"":"text-opacity-70")+"\n                  ml-2 h-5 w-5 text-[#747189]  transition duration-150 ease-in-out group-hover:text-opacity-80","aria-hidden":"true"})]}),(0,jsx_runtime.jsx)(transition.u,{as:react.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:(0,jsx_runtime.jsx)(popover.J.Panel,{ref,className:`fixed z-10 ${position?"-mt-[400px]":"mt-3"} w-screen max-w-sm transform lg:max-w-4xl`,children:(0,jsx_runtime.jsx)("div",{className:"overflow-hidden rounded-lg shadow-lg ring-1 ring-gray-500 dark:ring-black ring-opacity-5",children:(0,jsx_runtime.jsxs)("div",{className:"relative bg-white dark:bg-[#1D1C27] p-5 max-h-[85vh] text-gray-500 dark:text-white",children:[(0,jsx_runtime.jsxs)("div",{className:"w-full",children:[(0,jsx_runtime.jsx)("p",{className:"text-xl mb-1",children:"Size Axis"}),(0,jsx_runtime.jsx)(KeyValueSingleSelect,{metadataKeyValue:selectedSizeAxis,placeholder:"Select",countersConfigurations,selectedMetadataKeyValueChange:sizeAxisChanged})]}),(0,jsx_runtime.jsx)("div",{className:"w-full mt-2",children:(0,jsx_runtime.jsx)(Counters,{countersConfigurations,calculationsConfigurations:calculationsConfigurations.filter((calc=>"percentage"===calc.type)),currentCounters:currentColorsAxis,countersChanged:colorsAxisChanged,addCounterText:"Add axis",title:"Color Axis"})}),(0,jsx_runtime.jsx)("div",{className:"w-full mt-2",children:(0,jsx_runtime.jsx)(Counters,{countersConfigurations,calculationsConfigurations,currentCounters,countersChanged,addCounterText:"Add counter",title:"Counters"})}),(0,jsx_runtime.jsx)("div",{className:"w-full mt-2",children:(0,jsx_runtime.jsx)(Labels,{currentLabels:selectedLabels,labelsOptions:labelsOptions.sort(),labelsChanged})})]})})})})]})})})}CustomizeTab.displayName="CustomizeTab";try{CustomizeTab.displayName="CustomizeTab",CustomizeTab.__docgenInfo={description:"",displayName:"CustomizeTab",props:{currentCounters:{defaultValue:null,description:"",name:"currentCounters",required:!0,type:{name:"CounterType[]"}},selectedLabels:{defaultValue:null,description:"",name:"selectedLabels",required:!0,type:{name:"string[]"}},countersConfigurations:{defaultValue:null,description:"",name:"countersConfigurations",required:!0,type:{name:"CountersConfigurations"}},calculationsConfigurations:{defaultValue:null,description:"",name:"calculationsConfigurations",required:!0,type:{name:"CalculationConfiguration[]"}},labelsOptions:{defaultValue:null,description:"",name:"labelsOptions",required:!0,type:{name:"string[]"}},countersChanged:{defaultValue:null,description:"",name:"countersChanged",required:!0,type:{name:"(counters: CounterType[]) => void"}},labelsChanged:{defaultValue:null,description:"",name:"labelsChanged",required:!0,type:{name:"(labels: string[]) => void"}},currentColorsAxis:{defaultValue:null,description:"",name:"currentColorsAxis",required:!0,type:{name:"CounterType[]"}},selectedSizeAxis:{defaultValue:null,description:"",name:"selectedSizeAxis",required:!0,type:{name:"MetadataKeyValue | null"}},colorsAxisChanged:{defaultValue:null,description:"",name:"colorsAxisChanged",required:!0,type:{name:"(counters: CounterType[]) => void"}},sizeAxisChanged:{defaultValue:null,description:"",name:"sizeAxisChanged",required:!0,type:{name:"(metadataKeyValue: MetadataKeyValue) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/common/components/CustomizeTab.tsx#CustomizeTab"]={docgenInfo:CustomizeTab.__docgenInfo,name:"CustomizeTab",path:"src/common/components/CustomizeTab.tsx#CustomizeTab"})}catch(__react_docgen_typescript_loader_error){}var CalendarDaysIcon=__webpack_require__("./node_modules/@heroicons/react/20/solid/esm/CalendarDaysIcon.js"),subMonths=__webpack_require__("./node_modules/date-fns/esm/subMonths/index.js"),subYears=__webpack_require__("./node_modules/date-fns/esm/subYears/index.js"),addMonths=__webpack_require__("./node_modules/date-fns/esm/addMonths/index.js"),addYears=__webpack_require__("./node_modules/date-fns/esm/addYears/index.js"),isEqual=__webpack_require__("./node_modules/date-fns/esm/isEqual/index.js"),getDaysInMonth=__webpack_require__("./node_modules/date-fns/esm/getDaysInMonth/index.js"),getDay=__webpack_require__("./node_modules/date-fns/esm/getDay/index.js");function Datepicker({selectedDate,dateChanged,placeholder="Select Date"}){const[dayCount,setDayCount]=(0,react.useState)([]),[blankDays,setBlankDays]=(0,react.useState)([]),[showDatepicker,setShowDatepicker]=(0,react.useState)(!1),[datepickerHeaderDate,setDatepickerHeaderDate]=(0,react.useState)(new Date),[type,setType]=(0,react.useState)("date"),isToday=date=>selectedDate&&(0,isEqual.Z)(new Date(selectedDate.getFullYear(),selectedDate.getMonth(),date),selectedDate),isSelectedMonth=month=>selectedDate&&(0,isEqual.Z)(new Date(selectedDate.getFullYear(),month,selectedDate.getDate()),selectedDate),toggleDatepicker=()=>setShowDatepicker((prev=>!prev));return(0,react.useEffect)((()=>{(date=>{let daysInMonth=(0,getDaysInMonth.Z)(date),dayOfWeek=(0,getDay.Z)(new Date(date.getFullYear(),date.getMonth(),1)),blankDaysArray=[];for(let i=1;i<=dayOfWeek;i++)blankDaysArray.push(i);let daysArray=[];for(let i=1;i<=daysInMonth;i++)daysArray.push(i);setBlankDays(blankDaysArray),setDayCount(daysArray)})(datepickerHeaderDate)}),[datepickerHeaderDate]),(0,jsx_runtime.jsxs)("div",{className:"mb-5 w-64",children:[(0,jsx_runtime.jsx)("label",{htmlFor:"datepicker",className:"font-bold mb-1 text-gray-500 dark:text-white block",children:placeholder}),(0,jsx_runtime.jsxs)("div",{className:"relative",children:[(0,jsx_runtime.jsx)("input",{type:"hidden",name:"date"}),(0,jsx_runtime.jsx)("input",{type:"text",readOnly:!0,className:"cursor-pointer w-full pl-4 pr-10 py-3 leading-none rounded-lg shadow-sm focus:outline-none focus:shadow-outline bg-gray-200 dark:bg-[#2C293D] text-gray-700 dark:text-white font-medium",placeholder:"Select date",value:selectedDate?(0,format.Z)(selectedDate,"dd/MM/yyyy"):"",onClick:toggleDatepicker}),(0,jsx_runtime.jsx)("div",{className:"cursor-pointer absolute top-0 right-0 px-3 py-2",onClick:toggleDatepicker,children:(0,jsx_runtime.jsx)("svg",{className:"h-6 w-6 text-gray-600 dark:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,jsx_runtime.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),showDatepicker&&(0,jsx_runtime.jsxs)("div",{className:"bg-gray-200 dark:bg-[#272535] mt-1 rounded-lg shadow p-4 fixed z-10 overflow-auto",style:{width:"16rem"},children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("button",{type:"button",className:"transition ease-in-out duration-100 inline-flex cursor-pointer hover:bg-gray-400 hover:text-gray-900 dark:hover:bg-gray-200 dark:hover:text-gray-700 p-1 rounded-full",onClick:()=>{switch(type){case"date":case"year":setDatepickerHeaderDate((prev=>(0,subMonths.Z)(prev,1)));break;case"month":setDatepickerHeaderDate((prev=>(0,subYears.Z)(prev,1)))}},children:(0,jsx_runtime.jsx)("svg",{className:"h-6 w-6 text-gray-500 dark:text-gray-300 hover:text-gray-700 inline-flex",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,jsx_runtime.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})})}),"date"===type&&(0,jsx_runtime.jsx)("div",{onClick:()=>setType("month"),className:"flex-grow p-1 text-lg font-bold text-gray-400 dark:text-gray-200 cursor-pointer hover:bg-gray-400 dark:hover:bg-gray-200 hover:text-gray-700 rounded-lg",children:(0,jsx_runtime.jsx)("p",{className:"text-center",children:(0,format.Z)(datepickerHeaderDate,"MMMM")})}),(0,jsx_runtime.jsx)("div",{onClick:()=>setType("date"),className:"flex-grow p-1 text-lg font-bold text-gray-400 dark:text-gray-200 cursor-pointer hover:bg-gray-400 dark:hover:bg-gray-200 hover:text-gray-700 rounded-lg",children:(0,jsx_runtime.jsx)("p",{className:"text-center",children:(0,format.Z)(datepickerHeaderDate,"yyyy")})}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("button",{type:"button",className:"transition ease-in-out duration-100 inline-flex cursor-pointer hover:bg-gray-400 dark:hover:bg-gray-200 hover:text-gray-700 p-1 rounded-full",onClick:()=>{switch(type){case"date":setDatepickerHeaderDate((prev=>(0,addMonths.Z)(prev,1)));break;case"month":setDatepickerHeaderDate((prev=>(0,addYears.Z)(prev,1)));break;case"year":setDatepickerHeaderDate((prev=>(0,subMonths.Z)(prev,1)))}},children:(0,jsx_runtime.jsx)("svg",{className:"h-6 w-6 text-gray-500 dark:text-gray-300 hover:text-gray-700 inline-flex",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,jsx_runtime.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})})]}),"date"===type&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"flex flex-wrap mb-3 -mx-1",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(((day,i)=>(0,jsx_runtime.jsx)("div",{style:{width:"14.26%"},className:"px-1",children:(0,jsx_runtime.jsx)("div",{className:"text-gray-400 font-medium text-center text-xs",children:day})},i)))}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap -mx-1",children:[blankDays.map(((_,i)=>(0,jsx_runtime.jsx)("div",{style:{width:"14.26%"},className:"text-center border p-1 border-transparent text-sm"},i))),dayCount.map(((d,i)=>{return(0,jsx_runtime.jsx)("div",{style:{width:"14.26%"},className:"px-1 mb-1",children:(0,jsx_runtime.jsx)("div",{onClick:(date=d,()=>{dateChanged(new Date(datepickerHeaderDate.getFullYear(),datepickerHeaderDate.getMonth(),date)),setShowDatepicker(!1)}),className:"cursor-pointer text-center text-sm rounded-full leading-loose transition ease-in-out duration-100 "+(isToday(d)?"bg-blue-500 text-gray-300 dark:text-white":"text-gray-400 dark:text-gray-200 hover:bg-blue-200"),children:d})},i);var date}))]})]}),"month"===type&&(0,jsx_runtime.jsx)("div",{className:"flex flex-wrap -mx-1",children:Array(12).fill(null).map(((_,i)=>{return(0,jsx_runtime.jsx)("div",{onClick:(month=i,()=>{setDatepickerHeaderDate(new Date(datepickerHeaderDate.getFullYear(),month,datepickerHeaderDate.getDate())),setType("date")}),style:{width:"25%"},children:(0,jsx_runtime.jsx)("div",{className:"cursor-pointer p-5 font-semibold text-center text-sm rounded-lg hover:bg-gray-200 hover:text-gray-700 "+(isSelectedMonth(i)?"bg-blue-500 text-gray-500 dark:text-white":"text-gray-600 dark:text-gray-200 hover:bg-blue-200"),children:(0,format.Z)(new Date(datepickerHeaderDate.getFullYear(),i,datepickerHeaderDate.getDate()),"MMM")})},i);var month}))})," "]})]})]})}Datepicker.displayName="Datepicker";try{Datepicker.displayName="Datepicker",Datepicker.__docgenInfo={description:"",displayName:"Datepicker",props:{selectedDate:{defaultValue:null,description:"",name:"selectedDate",required:!0,type:{name:"Date | null"}},placeholder:{defaultValue:{value:"Select Date"},description:"",name:"placeholder",required:!1,type:{name:"string"}},dateChanged:{defaultValue:null,description:"",name:"dateChanged",required:!0,type:{name:"(date: Date) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/common/components/CustomizeTab/Datepicker.tsx#Datepicker"]={docgenInfo:Datepicker.__docgenInfo,name:"Datepicker",path:"src/common/components/CustomizeTab/Datepicker.tsx#Datepicker"})}catch(__react_docgen_typescript_loader_error){}function DatesFilters({fromDate,toDate,fromDateChanged,toDateChanged,trendPeriods,trendPeriodsChanged}){const[position,setPosition]=react.useState(!1),ref=react.useRef(null),onClick=()=>{"undefined"!=typeof window&&setTimeout((()=>{if(ref.current){ref.current.getBoundingClientRect().bottom>=window.innerHeight?setPosition(!0):setPosition(!1)}}),100)};return(0,jsx_runtime.jsx)(popover.J,{className:"relative",children:({open})=>(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(popover.J.Button,{onClick,className:`\n                ${open?"":"text-opacity-90"}\n                group inline-flex items-center rounded-md px-3 py-2 text-base font-medium text-gray-500 dark:text-white hover:text-opacity-100 focus:outline-none `,children:[(0,jsx_runtime.jsx)(CalendarDaysIcon.Z,{className:"h-7 w-7"}),(0,jsx_runtime.jsx)(esm_ChevronDownIcon.Z,{className:(open?"":"text-opacity-70")+"\n                  ml-2 h-5 w-5 text-[#747189] transition duration-150 ease-in-out group-hover:text-opacity-80","aria-hidden":"true"})]}),(0,jsx_runtime.jsx)(transition.u,{as:react.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:(0,jsx_runtime.jsx)(popover.J.Panel,{ref,className:`fixed z-10 ${position?"-mt-[300px]":"mt-3"} transform max-w-md`,children:(0,jsx_runtime.jsx)("div",{className:"overflow-hidden rounded-lg shadow-lg ring-1 ring-gray-500 dark:ring-black ring-opacity-5",children:(0,jsx_runtime.jsx)("div",{className:"relative bg-white dark:bg-[#272535] p-5",children:(0,jsx_runtime.jsx)("div",{className:"w-full",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap w-full mt-3 justify-between",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[(0,jsx_runtime.jsx)(Datepicker,{selectedDate:fromDate,dateChanged:fromDateChanged,placeholder:"From"}),(0,jsx_runtime.jsx)("div",{className:"ml-1",children:(0,jsx_runtime.jsxs)("button",{type:"button",onClick:()=>fromDateChanged(null),children:[(0,jsx_runtime.jsx)(XMarkIcon.Z,{className:"h-4 w-4 text-gray-500 dark:text-gray-200 hover:scale-125 transition duration-100 ease-linear"}),(0,jsx_runtime.jsx)("span",{className:"sr-only",children:"Clear dates filters"})]})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[(0,jsx_runtime.jsx)(Datepicker,{selectedDate:toDate,dateChanged:toDateChanged,placeholder:"To"}),(0,jsx_runtime.jsx)("div",{className:"ml-1",children:(0,jsx_runtime.jsxs)("button",{type:"button",onClick:()=>toDateChanged(null),children:[(0,jsx_runtime.jsx)(XMarkIcon.Z,{className:"h-4 w-4 text-gray-200 hover:scale-125 transition duration-100 ease-linear"}),(0,jsx_runtime.jsx)("span",{className:"sr-only",children:"Clear dates filters"})]})})]}),void 0!==trendPeriods&&trendPeriodsChanged&&(0,jsx_runtime.jsx)("div",{className:"flex items-center",children:(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{htmlFor:"small-input",className:"block mb-2 text-sm font-medium text-gray-500 dark:text-gray-300",children:"Trend periods amount"}),(0,jsx_runtime.jsx)("input",{type:"number",id:"small-input",onChange:e=>trendPeriodsChanged(Number(e.target.value)),value:trendPeriods,className:"block p-2 w-1/2 rounded-lg border sm:text-xs bg-gray-300 dark:bg-gray-700 border-gray-300 dark:border-gray-600 placeholder-gray-700 dark:placeholder-gray-400 text-gray-500 dark:text-white focus:ring-blue-500 focus:border-blue-500"})]})})]})})})})})})]})})}DatesFilters.displayName="DatesFilters";try{DatesFilters.displayName="DatesFilters",DatesFilters.__docgenInfo={description:"",displayName:"DatesFilters",props:{fromDate:{defaultValue:null,description:"",name:"fromDate",required:!0,type:{name:"Date | null"}},toDate:{defaultValue:null,description:"",name:"toDate",required:!0,type:{name:"Date | null"}},fromDateChanged:{defaultValue:null,description:"",name:"fromDateChanged",required:!0,type:{name:"(date: Date | null) => void"}},toDateChanged:{defaultValue:null,description:"",name:"toDateChanged",required:!0,type:{name:"(date: Date | null) => void"}},trendPeriods:{defaultValue:null,description:"",name:"trendPeriods",required:!1,type:{name:"number"}},trendPeriodsChanged:{defaultValue:null,description:"",name:"trendPeriodsChanged",required:!1,type:{name:"((index: number) => void)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/common/components/DatesFilters.tsx#DatesFilters"]={docgenInfo:DatesFilters.__docgenInfo,name:"DatesFilters",path:"src/common/components/DatesFilters.tsx#DatesFilters"})}catch(__react_docgen_typescript_loader_error){}var switch_switch=__webpack_require__("./node_modules/@headlessui/react/dist/components/switch/switch.js"),radio_group=__webpack_require__("./node_modules/@headlessui/react/dist/components/radio-group/radio-group.js"),Combination=__webpack_require__("./node_modules/react-focus-on/dist/es2015/Combination.js");function ItemActions({node,searchSimilarClusters,splitPhrase,mergeClusters,translationEnabled}){const controller=(0,react.useRef)(null),[isOpen,setIsOpen]=(0,react.useState)(!1),[loading,setLoading]=(0,react.useState)(!1),[action,setAction]=(0,react.useState)(null),[similarClusters,setSimilarClusters]=(0,react.useState)(null),[selectedClusters,setSelectedClusters]=(0,react.useState)(null),[searchText,setSearchText]=(0,react.useState)(null),[error,setError]=(0,react.useState)(null),[mergeTo,setMergeTo]=(0,react.useState)(!1);function closeModal(){setIsOpen(!1),setSelectedClusters(null),setMergeTo(!1),setSearchText(null),setError(null),setLoading(!1),setSimilarClusters(null),setAction(null)}return(0,react.useEffect)((()=>{node&&searchSimilarClusters&&("Cluster"===node.type?(setAction("Merge"),setSearchText("")):"Phrase"===node.type&&setAction("Split"),setIsOpen(!0))}),[node]),(0,react.useEffect)((()=>{controller.current&&!isOpen&&controller.current.abort(),isOpen||(setError(null),setLoading(!1),setAction(null),setSimilarClusters(null),setSelectedClusters(null),setSearchText(null),controller.current=new AbortController)}),[isOpen]),(0,react.useEffect)((()=>{if(null===searchText||!node||!searchSimilarClusters)return;const currentController=new AbortController;return(async controller=>{try{setLoading(!0);const res=await searchSimilarClusters(""===searchText?node.text:searchText,controller);setSimilarClusters(res)}catch(e){console.error(e)}finally{setLoading(!1)}})(currentController).catch((e=>{console.error(e)})),()=>{currentController.abort()}}),[searchText,node,searchSimilarClusters]),isOpen?(0,jsx_runtime.jsx)(Combination.Y,{as:"div",className:"relative z-10",onClickOutside:closeModal,children:(0,jsx_runtime.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,jsx_runtime.jsx)("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:(0,jsx_runtime.jsxs)("div",{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white dark:bg-[#272535] p-6 text-left align-middle shadow-xl transition-all",children:[(0,jsx_runtime.jsxs)("h3",{className:"text-center text-lg font-medium leading-6 text-gray-900 dark:text-white",children:["Merge"===action?(0,jsx_runtime.jsx)("div",{children:"Merging:"}):(0,jsx_runtime.jsx)("span",{children:"Split to a new cluster:"}),(0,jsx_runtime.jsxs)("span",{className:"group relative flex w-full",children:['"',(0,jsx_runtime.jsx)("span",{className:"truncate",children:node?.text}),'"',(0,jsx_runtime.jsx)("span",{className:"absolute hidden group-hover:flex -left-5 -translate-y-full px-2 py-1 bg-gray-700 rounded-lg text-center text-white text-sm after:content-[''] after:absolute after:left-1/2 after:top-[100%] after:-translate-x-1/2 after:border-8 after:border-x-transparent after:border-b-transparent after:border-t-gray-700",children:node?.text})]})]}),error&&(0,jsx_runtime.jsxs)("p",{id:"filled_error_help",className:"mt-2 text-xs text-red-600 dark:text-red-400",children:[(0,jsx_runtime.jsx)("span",{className:"font-medium",children:"Oh, snapp!"})," ",error]}),null!==searchText?(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("input",{type:"text",value:searchText,onChange:e=>setSearchText(e.target.value),id:"search",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:"Search for clusters",required:!0})}):null,"Merge"===action?(0,jsx_runtime.jsxs)("div",{className:"flex w-full mt-1 items-center align-middle justify-center",children:[(0,jsx_runtime.jsx)("span",{className:"mr-1 "+(mergeTo?"text-gray-400 ":"text-white"),children:"Merge From"}),(0,jsx_runtime.jsxs)(switch_switch.r,{checked:mergeTo,onChange:()=>setMergeTo((state=>(setSelectedClusters([]),!state))),className:(mergeTo?"bg-teal-900":"bg-teal-700")+"\n          relative inline-flex h-[38px] w-[74px] shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus-visible:ring-2  focus-visible:ring-white focus-visible:ring-opacity-75",children:[(0,jsx_runtime.jsx)("span",{className:"sr-only",children:"Use setting"}),(0,jsx_runtime.jsx)("span",{"aria-hidden":"true",className:(mergeTo?"translate-x-9":"translate-x-0")+"\n            pointer-events-none inline-block h-[34px] w-[34px] transform rounded-full bg-white shadow-lg ring-0 transition duration-200 ease-in-out"})]}),(0,jsx_runtime.jsx)("span",{className:"ml-1 "+(mergeTo?"text-white ":"text-gray-400"),children:"Merge To"})]}):null,loading?(0,jsx_runtime.jsx)("div",{className:"grow w-full justify-center items-center flex mt-2",children:(0,jsx_runtime.jsx)("div",{className:"text-center",children:(0,jsx_runtime.jsxs)("div",{role:"status",children:[(0,jsx_runtime.jsxs)("svg",{className:"inline mr-2 w-8 h-8 text-gray-200 animate-spin fill-blue-600",viewBox:"0 0 100 101",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,jsx_runtime.jsx)("path",{d:"M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z",fill:"currentColor"}),(0,jsx_runtime.jsx)("path",{d:"M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z",fill:"currentFill"})]}),(0,jsx_runtime.jsx)("span",{className:"sr-only",children:"Loading..."})]})})}):similarClusters&&(0,jsx_runtime.jsx)("div",{className:"overflow-y-auto max-h-64 mt-2",children:(0,jsx_runtime.jsx)(ClustersList,{clusters:similarClusters.filter((c=>c.id.toString()!==node?.id)),selected:selectedClusters,clusterSelected:function clusterSelected(clusterId,selected){return setSelectedClusters(selected?current=>current?.filter((c=>c!==clusterId))??[]:mergeTo?[clusterId]:selected=>[...selected??[],clusterId])},translationEnabled})}),(0,jsx_runtime.jsxs)("div",{className:"mt-4 flex justify-between",children:[(0,jsx_runtime.jsx)("button",{type:"button",className:"text-center w-1/3 rounded-md border border-transparent bg-green-100 px-4 py-2 text-sm font-medium text-green-900 hover:bg-green-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-green-500 focus-visible:ring-offset-2",onClick:async function invokeAction(){if(!(splitPhrase&&mergeClusters&&controller.current&&node))return closeModal();if(setError(null),setLoading(!0),"Split"===action){const res=await splitPhrase(node.id,controller.current);res.message?setError(res.message):closeModal()}else{const firstSelectedCluster=selectedClusters?.at(0);if(selectedClusters&&selectedClusters.length>0&&firstSelectedCluster){let res;res=mergeTo?await mergeClusters([node.id],firstSelectedCluster,controller.current):await mergeClusters(selectedClusters,node.id,controller.current),res&&res.message?setError(res.message):closeModal()}}setLoading(!1)},disabled:loading||"Merge"===action&&!selectedClusters,children:action}),(0,jsx_runtime.jsx)("button",{type:"button",className:"text-center w-1/3 rounded-md border border-transparent bg-blue-100 px-4 py-2 text-sm font-medium text-blue-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2",onClick:closeModal,children:"Cancel"})]})]})})})}):null}function ClustersList({clusters,selected,clusterSelected,translationEnabled}){return(0,jsx_runtime.jsx)("div",{className:"w-full pr-1 py-2",children:(0,jsx_runtime.jsx)("div",{className:"mx-auto w-full max-w-md",children:(0,jsx_runtime.jsxs)(radio_group.E,{children:[(0,jsx_runtime.jsx)(radio_group.E.Label,{className:"sr-only",children:"Select Destination Cluster"}),(0,jsx_runtime.jsx)("div",{className:"space-y-2",children:clusters.map((cluster=>{const checked=selected?.some((c=>c===cluster.id))??!1;return(0,jsx_runtime.jsx)(radio_group.E.Option,{value:cluster,onClick:()=>clusterSelected(cluster.id,checked),className:`\n                  ${checked?"bg-sky-900 bg-opacity-75 text-white":"bg-white"}\n                    relative flex cursor-pointer rounded-lg px-5 py-4 shadow-md focus:outline-none`,children:(0,jsx_runtime.jsxs)("div",{className:"flex w-full items-center justify-between",children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center",children:(0,jsx_runtime.jsx)("div",{className:"text-sm",children:(0,jsx_runtime.jsx)(radio_group.E.Label,{as:"p",className:"font-medium  "+(checked?"text-white":"text-gray-900"),children:translationEnabled&&cluster.translation?cluster.translation:cluster.text})})}),checked&&(0,jsx_runtime.jsx)("div",{className:"shrink-0 text-white",children:(0,jsx_runtime.jsx)(CheckIcon,{className:"h-6 w-6"})})]})},cluster.id)}))})]})})})}function CheckIcon(props){return(0,jsx_runtime.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",...props,children:[(0,jsx_runtime.jsx)("circle",{cx:12,cy:12,r:12,fill:"#fff",opacity:"0.2"}),(0,jsx_runtime.jsx)("path",{d:"M7 13l3 3 7-7",stroke:"#fff",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})]})}ClustersList.displayName="ClustersList",CheckIcon.displayName="CheckIcon";try{ItemActions.displayName="ItemActions",ItemActions.__docgenInfo={description:"",displayName:"ItemActions",props:{node:{defaultValue:null,description:"",name:"node",required:!0,type:{name:"{ type: NodeType; id: string; text: string; } | null"}},searchSimilarClusters:{defaultValue:null,description:"",name:"searchSimilarClusters",required:!1,type:{name:"((text: string, controller: AbortController) => Promise<{ id: string; text: string; translation: string | null; }[]>)"}},splitPhrase:{defaultValue:null,description:"",name:"splitPhrase",required:!1,type:{name:'((phraseId: string, controller: AbortController) => Promise<{ status: "error" | "Success"; message: string; }>)'}},mergeClusters:{defaultValue:null,description:"",name:"mergeClusters",required:!1,type:{name:'((source: string[], destination: string, controller: AbortController) => Promise<{ status: "error" | "Success"; message: string; }>)'}},translationEnabled:{defaultValue:null,description:"",name:"translationEnabled",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/common/components/ItemActions.tsx#ItemActions"]={docgenInfo:ItemActions.__docgenInfo,name:"ItemActions",path:"src/common/components/ItemActions.tsx#ItemActions"})}catch(__react_docgen_typescript_loader_error){}var HashtagIcon=__webpack_require__("./node_modules/@heroicons/react/20/solid/esm/HashtagIcon.js"),FilmIcon=__webpack_require__("./node_modules/@heroicons/react/20/solid/esm/FilmIcon.js"),GlobeAmericasIcon=__webpack_require__("./node_modules/@heroicons/react/20/solid/esm/GlobeAmericasIcon.js"),HandThumbUpIcon=__webpack_require__("./node_modules/@heroicons/react/24/outline/esm/HandThumbUpIcon.js"),HandThumbDownIcon=__webpack_require__("./node_modules/@heroicons/react/24/outline/esm/HandThumbDownIcon.js"),FaceSmileIcon=__webpack_require__("./node_modules/@heroicons/react/24/outline/esm/FaceSmileIcon.js"),FaceFrownIcon=__webpack_require__("./node_modules/@heroicons/react/24/outline/esm/FaceFrownIcon.js"),UserIcon=__webpack_require__("./node_modules/@heroicons/react/24/outline/esm/UserIcon.js"),KeyIcon=__webpack_require__("./node_modules/@heroicons/react/24/outline/esm/KeyIcon.js"),GlobeAltIcon=__webpack_require__("./node_modules/@heroicons/react/24/outline/esm/GlobeAltIcon.js"),BuildingOffice2Icon=__webpack_require__("./node_modules/@heroicons/react/24/outline/esm/BuildingOffice2Icon.js"),MapPinIcon=__webpack_require__("./node_modules/@heroicons/react/24/outline/esm/MapPinIcon.js"),UsersIcon=__webpack_require__("./node_modules/@heroicons/react/24/outline/esm/UsersIcon.js"),ScaleIcon=__webpack_require__("./node_modules/@heroicons/react/24/outline/esm/ScaleIcon.js"),CalendarIcon=__webpack_require__("./node_modules/@heroicons/react/24/outline/esm/CalendarIcon.js"),HeartIcon=__webpack_require__("./node_modules/@heroicons/react/24/outline/esm/HeartIcon.js");const defaultCountersConfigurations={signals:{display:{color:"white",icon:(0,jsx_runtime.jsxs)("span",{className:"flex flex-col",style:{height:"1em"},children:[(0,jsx_runtime.jsx)(HandThumbUpIcon.Z,{}),(0,jsx_runtime.jsx)(HandThumbDownIcon.Z,{})]})},items:[{label:"positive",display:{color:"green",icon:(0,jsx_runtime.jsx)(FaceSmileIcon.Z,{})},members:[{metadataName:"emotion",values:["happiness"]},{metadataName:"sentiment",values:["POS"]}],isGroup:!0},{label:"negative",display:{color:"red",icon:(0,jsx_runtime.jsx)(FaceFrownIcon.Z,{})},members:[{metadataName:"emotion",values:["anger","sadness"]},{metadataName:"sentiment",values:["NEG"]}],isGroup:!0}]},person:{display:{color:"white",icon:(0,jsx_runtime.jsx)(UserIcon.Z,{})}},topic:{display:{color:"white",icon:(0,jsx_runtime.jsx)(HashtagIcon.Z,{})}},keyword:{display:{color:"white",icon:(0,jsx_runtime.jsx)(KeyIcon.Z,{})}},geo:{display:{color:"white",icon:(0,jsx_runtime.jsx)(GlobeAltIcon.Z,{})}},org:{display:{color:"white",icon:(0,jsx_runtime.jsx)(BuildingOffice2Icon.Z,{})}},location:{display:{color:"white",icon:(0,jsx_runtime.jsx)(MapPinIcon.Z,{})}},groups:{display:{color:"white",icon:(0,jsx_runtime.jsx)(UsersIcon.Z,{})}},art:{display:{color:"white",icon:(0,jsx_runtime.jsx)(FilmIcon.Z,{})}},law:{display:{color:"white",icon:(0,jsx_runtime.jsx)(ScaleIcon.Z,{})}},event:{display:{color:"white",icon:(0,jsx_runtime.jsx)(CalendarIcon.Z,{})}},sentiment:{display:{color:"white",icon:(0,jsx_runtime.jsxs)("span",{className:"flex flex-col",style:{height:"1em"},children:[(0,jsx_runtime.jsx)(HandThumbUpIcon.Z,{}),(0,jsx_runtime.jsx)(HandThumbDownIcon.Z,{})]})},items:[{label:"POS",display:{color:"green",icon:(0,jsx_runtime.jsx)(HandThumbUpIcon.Z,{})}},{label:"NEG",display:{color:"red",icon:(0,jsx_runtime.jsx)(HandThumbDownIcon.Z,{})}}]},emotion:{display:{color:"white",icon:(0,jsx_runtime.jsx)(HeartIcon.Z,{})},items:[{label:"positive",display:{color:"green",icon:(0,jsx_runtime.jsx)(FaceSmileIcon.Z,{})},members:[{values:["happiness"]}],isGroup:!0},{label:"negative",display:{color:"red",icon:(0,jsx_runtime.jsx)(FaceFrownIcon.Z,{})},members:[{values:["anger","sadness"]}],isGroup:!0},{label:"happiness",display:{color:"green",icon:(0,jsx_runtime.jsx)(FaceSmileIcon.Z,{})}},{label:"surprise",display:{color:"green",icon:(0,jsx_runtime.jsx)(FaceSmileIcon.Z,{})}},{label:"anger",display:{color:"red",icon:(0,jsx_runtime.jsx)(FaceFrownIcon.Z,{})}},{label:"sadness",display:{color:"red",icon:(0,jsx_runtime.jsx)(FaceFrownIcon.Z,{})}}]},score:{display:{color:"white",icon:(0,jsx_runtime.jsxs)("span",{className:"flex flex-col",style:{height:"1em"},children:[(0,jsx_runtime.jsx)(HandThumbUpIcon.Z,{}),(0,jsx_runtime.jsx)(HandThumbDownIcon.Z,{})]})},items:[{label:"2",display:{color:"green",icon:(0,jsx_runtime.jsx)(HandThumbUpIcon.Z,{})}},{label:"1",display:{color:"green",icon:(0,jsx_runtime.jsx)(HandThumbUpIcon.Z,{})}},{label:"-1",display:{color:"red",icon:(0,jsx_runtime.jsx)(HandThumbDownIcon.Z,{})}},{label:"-2",display:{color:"red",icon:(0,jsx_runtime.jsx)(HandThumbDownIcon.Z,{})}},{label:"positive",display:{color:"green",icon:(0,jsx_runtime.jsx)(HandThumbUpIcon.Z,{})},members:[{values:["1","2"]}],isGroup:!0},{label:"positive",display:{color:"red",icon:(0,jsx_runtime.jsx)(HandThumbDownIcon.Z,{})},members:[{values:["-1","-2"]}],isGroup:!0}]},city:{display:{color:"white",icon:(0,jsx_runtime.jsx)(GlobeAmericasIcon.Z,{})}}},defaultCalculations=[totalSumCalculationConfiguration,topValueCalculationConfiguration,topValuePercentCalculationConfiguration,topGroupCalculationConfiguration,topGroupPercentCalculationConfiguration,percentOfItemsCalculationConfiguration,percentOfAllItemsCalculationConfiguration,trendCalculationConfiguration,percentOfTotalUniqueItemsCalculationConfiguration,totalUniqueItemsCalculationConfiguration];var EllipsisHorizontalIcon=__webpack_require__("./node_modules/@heroicons/react/24/outline/esm/EllipsisHorizontalIcon.js"),src=__webpack_require__("./node_modules/d3/src/index.js");function ColorsAxis({width,colorsConfig}){return(0,jsx_runtime.jsx)("div",{style:{width,opacity:.9},className:"h-full fixed flex flex-col",children:colorsConfig.map(((colorConfig,i)=>(0,jsx_runtime.jsx)("div",{className:"w-full",style:{background:colorConfig,height:"4px",marginTop:0===i?"auto":"1px"}},i)))})}ColorsAxis.displayName="ColorsAxis";try{ColorsAxis.displayName="ColorsAxis",ColorsAxis.__docgenInfo={description:"",displayName:"ColorsAxis",props:{width:{defaultValue:null,description:"",name:"width",required:!0,type:{name:"number"}},colorsConfig:{defaultValue:null,description:"",name:"colorsConfig",required:!0,type:{name:"string[]"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/common/components/CountersLabels/ColorsAxis.tsx#ColorsAxis"]={docgenInfo:ColorsAxis.__docgenInfo,name:"ColorsAxis",path:"src/common/components/CountersLabels/ColorsAxis.tsx#ColorsAxis"})}catch(__react_docgen_typescript_loader_error){}const BarChart=({dataNodes,height,width,nodeClicked,barColor,fontFamily,textColor,counters,countersConfiguration,labels,labelClicked,sizeAxis,colorAxis,translate,totalItems,nodeActionsClicked,totalUniqueItemsStats,uniquePropertyName})=>{const[actionsVisible,setActionsVisible]=(0,react.useState)(null),barsHeight=40*dataNodes.length,[groups,setGroups]=(0,react.useState)([]);(0,react.useEffect)((()=>{setGroups(dataNodes.sort(((a,b)=>sizeAxis?.key===CUSTOM_METADATA_KEY?b.amount-a.amount:totalSumCalculation(sizeAxis,b.metadata,b.trends,countersConfiguration).result-totalSumCalculation(sizeAxis,a.metadata,b.trends,countersConfiguration).result)).map((d=>d.text??"")))}),[dataNodes,sizeAxis]);const yScale=(0,react.useMemo)((()=>(0,src.tiA)().domain(groups).range([0,barsHeight]).padding(.1)),[height,groups]),max=(0,react.useMemo)((()=>(0,src.Wem)(dataNodes.map((d=>sizeAxis?.key===CUSTOM_METADATA_KEY?d.amount:totalSumCalculation(sizeAxis,d.metadata,d.trends,countersConfiguration).result)))[1]??20),[dataNodes,sizeAxis]),xScale=(0,react.useMemo)((()=>(0,src.BYU)().domain([0,max||10]).range([0,width])),[width,max]),allShapes=dataNodes.map(((d,i)=>{const y=yScale(d.text??"")??0,result=sizeAxis?.key===CUSTOM_METADATA_KEY?d.amount:totalSumCalculation(sizeAxis,d.metadata,d.trends,countersConfiguration).result,xWidth=xScale(result===max?result:Math.min(max-1,result+.1*max))-24,barWidth=xWidth>0?xWidth:0,fill=barColor,colorsConfig=getBackgroundColorLayers(colorAxis,d.metadata,d.trends,countersConfiguration,totalItems,totalUniqueItemsStats,d.metadata_stats,uniquePropertyName);return(0,jsx_runtime.jsxs)("g",{children:[(0,jsx_runtime.jsx)("rect",{x:24,y,width:barWidth,height:36,opacity:1,fill,fillOpacity:1,rx:1}),(0,jsx_runtime.jsx)("foreignObject",{x:24,y,width,height:36,opacity:1,fill,fillOpacity:1,rx:1,children:(0,jsx_runtime.jsxs)("div",{className:"h-full w-full",onMouseEnter:()=>{nodeActionsClicked(d),setActionsVisible(i)},onMouseLeave:()=>{setActionsVisible(null)},children:[(0,jsx_runtime.jsx)(ColorsAxis,{width:barWidth,colorsConfig}),(0,jsx_runtime.jsxs)("div",{className:"flex h-full w-full items-center ml-1 relative text-gray-500",style:{fontFamily,fontWeight:300,fontStyle:"normal",color:textColor,fontSize:"14px"},children:[(0,jsx_runtime.jsx)("span",{className:"flex items-center max-w-[30%] truncate mr-2",children:counters.filter((counter=>null!==counter.metadataKeyValue)).map(((counter,i)=>(0,jsx_runtime.jsx)("div",{className:"ml-1",children:(0,jsx_runtime.jsx)(CounterDisplay,{counter,countersConfiguration,metadata:d.metadata,trends:d.trends,width:"6ch",totalItems,totalUniqueItemsStats,uniquePropertyName,uniqueItemsStats:d.metadata_stats})},i)))}),(0,jsx_runtime.jsx)("span",{className:"truncate w-3/6 hover:text-gray-400 dark:hover:text-gray-300 hover:cursor-pointer",onClick:()=>nodeClicked(d),dir:"auto",children:translate&&void 0!==d.item_translated_text&&null!==d.item_translated_text&&""!==d.item_translated_text?d.item_translated_text:d.item_original_text}),(0,jsx_runtime.jsx)("span",{className:"truncate flex items-center w-2/6 ml-auto",children:labels.map(((label,i)=>(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(MaxLabelDisplay,{countersConfiguration,metadataKey:label,labelClicked,metadata:d.metadata,width:"15ch"})},i)))}),(0,jsx_runtime.jsx)("div",{"data-for":"global-actions","data-tip":!0,"data-event":"click",className:"self-end mr-1 hover:cursor-pointer hover:text-white "+(actionsVisible===i?"visible":"invisible"),children:(0,jsx_runtime.jsx)(EllipsisHorizontalIcon.Z,{className:"h-4 w-4"})})]})]})})]},i)}));return(0,jsx_runtime.jsx)("svg",{width,height:barsHeight,children:allShapes})};BarChart.displayName="BarChart";try{BarChart.displayName="BarChart",BarChart.__docgenInfo={description:"",displayName:"BarChart",props:{dataNodes:{defaultValue:null,description:"",name:"dataNodes",required:!0,type:{name:"DataNode[]"}},width:{defaultValue:null,description:"",name:"width",required:!0,type:{name:"number"}},height:{defaultValue:null,description:"",name:"height",required:!0,type:{name:"number"}},nodeClicked:{defaultValue:null,description:"",name:"nodeClicked",required:!0,type:{name:"(node: DataNode) => void"}},barColor:{defaultValue:null,description:"",name:"barColor",required:!1,type:{name:"string"}},fontFamily:{defaultValue:null,description:"",name:"fontFamily",required:!1,type:{name:"string"}},textColor:{defaultValue:null,description:"",name:"textColor",required:!1,type:{name:"string"}},labels:{defaultValue:null,description:"",name:"labels",required:!0,type:{name:"string[]"}},counters:{defaultValue:null,description:"",name:"counters",required:!0,type:{name:"CounterType[]"}},countersConfiguration:{defaultValue:null,description:"",name:"countersConfiguration",required:!0,type:{name:"CountersConfigurations"}},labelClicked:{defaultValue:null,description:"",name:"labelClicked",required:!0,type:{name:"(key: string, value: string) => void"}},sizeAxis:{defaultValue:null,description:"",name:"sizeAxis",required:!0,type:{name:"MetadataKeyValue | null"}},colorAxis:{defaultValue:null,description:"",name:"colorAxis",required:!0,type:{name:"CounterType[]"}},nodeActionsClicked:{defaultValue:null,description:"",name:"nodeActionsClicked",required:!0,type:{name:"(node: DataNode) => void"}},translate:{defaultValue:null,description:"",name:"translate",required:!0,type:{name:"boolean"}},totalItems:{defaultValue:null,description:"",name:"totalItems",required:!0,type:{name:"number"}},totalUniqueItemsStats:{defaultValue:null,description:"",name:"totalUniqueItemsStats",required:!1,type:{name:"UniqueItemsStats"}},uniquePropertyName:{defaultValue:null,description:"",name:"uniquePropertyName",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/BarChart.tsx#BarChart"]={docgenInfo:BarChart.__docgenInfo,name:"BarChart",path:"src/components/BarChart.tsx#BarChart"})}catch(__react_docgen_typescript_loader_error){}var parse=__webpack_require__("./node_modules/date-fns/esm/parse/index.js");const ItemsListDisplay=({items,bgColor,textColor,counters,labels,countersConfiguration,labelClicked,translate,totalItems})=>(0,jsx_runtime.jsx)("div",{className:"overflow-x-auto text-black bg-[#F7F7F7] dark:bg-[#272535] dark:text-white",style:{backgroundColor:bgColor,color:textColor},children:(0,jsx_runtime.jsxs)("table",{className:"table-auto w-full h-full text-left",children:[(0,jsx_runtime.jsx)("thead",{className:"border-b-2 border-b-slate-500",children:(0,jsx_runtime.jsxs)("tr",{children:[(0,jsx_runtime.jsx)("th",{className:"p-1",children:"Items"}),(0,jsx_runtime.jsx)("th",{className:"p-1",children:"Time"}),counters.filter((counter=>counter.metadataKeyValue?.key!==CUSTOM_METADATA_KEY)).map(((counter,i)=>(0,jsx_runtime.jsx)("th",{className:"p-1 lowercase first-letter:uppercase",children:counter.metadataKeyValue?getMetadataKeyValueDisplay(counter.metadataKeyValue):""},i))),labels.map(((label,i)=>(0,jsx_runtime.jsx)("th",{className:"p-1 lowercase first-letter:uppercase",children:label},i)))]})}),(0,jsx_runtime.jsx)("tbody",{children:items.map(((item,i)=>{const item_date=function parseDate(date){return date?(0,format.Z)((0,parse.Z)(date,"yyyy-MM-dd HH:mm:ss.SSSSSS",new Date),"dd/MM/yyyy HH:mm"):""}(item.item_timestamp);return(0,jsx_runtime.jsxs)("tr",{children:[(0,jsx_runtime.jsx)("td",{className:"max-w-[60ch] truncate p-1",children:translate&&void 0!==item.item_translated_text&&null!==item.item_translated_text&&""!==item.item_translated_text?item.item_translated_text:item.original_text}),(0,jsx_runtime.jsx)("td",{className:"p-1","data-for":"global","data-tip":item_date,style:{width:"1em",height:"1em"},children:item_date.split(" ").at(0)}),counters.filter((counter=>counter.metadataKeyValue?.key!==CUSTOM_METADATA_KEY)).map(((counter,i)=>(0,jsx_runtime.jsx)("td",{className:"p-1",children:(0,jsx_runtime.jsx)(CounterDisplay,{counter,countersConfiguration,metadata:item.metadata,trends:[],totalItems})},i))),labels.map(((label,i)=>(0,jsx_runtime.jsx)("td",{children:(0,jsx_runtime.jsx)(MaxLabelDisplay,{metadataKey:label,labelClicked,countersConfiguration,metadata:item.metadata})},i)))]},i)}))})]})});ItemsListDisplay.displayName="ItemsListDisplay";try{ItemsListDisplay.displayName="ItemsListDisplay",ItemsListDisplay.__docgenInfo={description:"",displayName:"ItemsListDisplay",props:{items:{defaultValue:null,description:"",name:"items",required:!0,type:{name:"Item[]"}},bgColor:{defaultValue:null,description:"",name:"bgColor",required:!1,type:{name:"string"}},textColor:{defaultValue:null,description:"",name:"textColor",required:!1,type:{name:"string"}},labels:{defaultValue:null,description:"",name:"labels",required:!0,type:{name:"string[]"}},counters:{defaultValue:null,description:"",name:"counters",required:!0,type:{name:"CounterType[]"}},countersConfiguration:{defaultValue:null,description:"",name:"countersConfiguration",required:!0,type:{name:"CountersConfigurations"}},labelClicked:{defaultValue:null,description:"",name:"labelClicked",required:!0,type:{name:"(key: string, value: string) => void"}},translate:{defaultValue:null,description:"",name:"translate",required:!0,type:{name:"boolean"}},totalItems:{defaultValue:null,description:"",name:"totalItems",required:!0,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/ItemsListDisplay.tsx#ItemsListDisplay"]={docgenInfo:ItemsListDisplay.__docgenInfo,name:"ItemsListDisplay",path:"src/components/ItemsListDisplay.tsx#ItemsListDisplay"})}catch(__react_docgen_typescript_loader_error){}var chroma=__webpack_require__("./node_modules/chroma-js/chroma.js");const Treemap=({dataNodes,nodeClicked,height,width,bigColor,smallColor,countFontSize=14,fontFamily,textColor,borderWidth=0,borderColor,labels,counters,countersConfiguration,labelClicked,sizeAxis,colorAxis,nodeActionsClicked,translate,totalItems,totalUniqueItemsStats,uniquePropertyName})=>{const mainNode=(0,react.useMemo)((()=>({id:"",children:dataNodes.map((c=>({...c,amount:sizeAxis?.key===CUSTOM_METADATA_KEY?c.amount:totalSumCalculation(sizeAxis,c.metadata,c.trends,countersConfiguration).result,children:[]}))),amount:0,metadata:{},trends:[],type:"",properties:{}})),[dataNodes,sizeAxis]),treeHierarchy=(0,react.useMemo)((()=>{const elementsValues=mainNode.children.map((item=>item.amount)),maxElementValue=Math.max(...elementsValues),elementsSum=elementsValues.reduce(((a,b)=>a+b),0),growFactor=maxElementValue>.9*elementsSum?.1/(1-maxElementValue/elementsSum):1;return(0,src.bT9)(mainNode).sum((d=>maxElementValue===d.amount?d.amount:d.amount*growFactor)).sort(((n1,n2)=>n2.data.amount-n1.data.amount))}),[mainNode]),root=(0,react.useMemo)((()=>(0,src.pNI)().size([width,height]).padding(0)(treeHierarchy)),[treeHierarchy,width,height]),colors=(0,react.useMemo)((()=>{const len=root.leaves().length;return bigColor&&smallColor&&(0,chroma.valid)(bigColor)&&(0,chroma.valid)(smallColor)?(0,chroma.scale)([bigColor,smallColor]).domain([0,len]):(0,chroma.scale)(["#322F46","#2C293D"]).domain([0,len])}),[root,bigColor,smallColor]),[actionsVisible,setActionsVisible]=(0,react.useState)(null),allShapes=root.leaves().map(((leaf,index)=>{const height=leaf.y1-leaf.y0,width=leaf.x1-leaf.x0,fontSize=function calculateFontSize(height,width){let fontSize=10+height*width*32/235e3;return fontSize=Math.max(fontSize,10),fontSize=Math.min(fontSize,60),fontSize}(height,width),lineHeight=1.1*fontSize+5,lines=Math.max(1,Math.floor((height-10+20)/lineHeight)-3),colorsConfig=getBackgroundColorLayers(colorAxis,leaf.data.metadata,leaf.data.trends,countersConfiguration,totalItems,totalUniqueItemsStats,leaf.data.metadata_stats,uniquePropertyName);return(0,jsx_runtime.jsxs)("g",{children:[(0,jsx_runtime.jsx)("rect",{x:leaf.x0,y:leaf.y0,width,height,stroke:"transparent",fill:colors(index).hex()}),(0,jsx_runtime.jsx)("foreignObject",{x:leaf.x0,y:leaf.y0,width,height,children:(0,jsx_runtime.jsxs)("div",{className:"h-full w-full",onMouseEnter:()=>{nodeActionsClicked(leaf.data),setActionsVisible(index)},onMouseLeave:()=>{setActionsVisible(null)},children:[(0,jsx_runtime.jsx)(ColorsAxis,{width,colorsConfig}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col h-full w-full p-1 relative border-slate-500 dark:border-[#272535] text-black dark:text-white",style:{fontFamily,fontWeight:300,fontStyle:"normal",color:textColor,borderRightWidth:`${borderWidth}px`,borderLeftWidth:`${borderWidth}px`,borderBottomWidth:`${borderWidth}px`,borderColor},children:[(0,jsx_runtime.jsx)("div",{className:"flex",style:{fontSize:`${countFontSize}px`},children:(0,jsx_runtime.jsx)(CountersLabelsDisplay,{counters,labels,metadata:leaf.data.metadata,trends:leaf.data.trends,countersConfiguration,labelClicked,totalItems,totalUniqueItemsStats,uniquePropertyName,uniqueItemsStats:leaf.data.metadata_stats})}),(0,jsx_runtime.jsx)("span",{className:"items-center flex justify-center h-full hover:cursor-pointer",onClick:()=>nodeClicked(leaf.data),style:{fontSize:`${fontSize}px`},children:(0,jsx_runtime.jsx)("span",{"data-element":"rect-text",className:"overflow-hidden text-center",dir:"auto",style:{lineHeight:`${lineHeight}px`,wordBreak:"break-word",WebkitLineClamp:lines,WebkitTouchCallout:"none",display:"-webkit-box",WebkitBoxOrient:"vertical"},children:translate&&void 0!==leaf.data.item_translated_text&&null!==leaf.data.item_translated_text&&""!==leaf.data.item_translated_text?leaf.data.item_translated_text:leaf.data.item_original_text})}),(0,jsx_runtime.jsx)("div",{"data-for":"global-actions","data-tip":!0,"data-event":"click",className:"self-end hover:cursor-pointer hover:text-white "+(actionsVisible===index?"visible":"invisible"),children:(0,jsx_runtime.jsx)(EllipsisHorizontalIcon.Z,{className:"h-4 w-4"})})]})]})})]},index)}));return(0,jsx_runtime.jsx)("svg",{width,height,children:allShapes})};Treemap.displayName="Treemap";try{Treemap.displayName="Treemap",Treemap.__docgenInfo={description:"",displayName:"Treemap",props:{dataNodes:{defaultValue:null,description:"",name:"dataNodes",required:!0,type:{name:"DataNode[]"}},width:{defaultValue:null,description:"",name:"width",required:!0,type:{name:"number"}},height:{defaultValue:null,description:"",name:"height",required:!0,type:{name:"number"}},nodeClicked:{defaultValue:null,description:"",name:"nodeClicked",required:!0,type:{name:"(node: DataNode) => void"}},bigColor:{defaultValue:null,description:"",name:"bigColor",required:!1,type:{name:"string"}},smallColor:{defaultValue:null,description:"",name:"smallColor",required:!1,type:{name:"string"}},countFontSize:{defaultValue:{value:"14"},description:"",name:"countFontSize",required:!1,type:{name:"number"}},fontFamily:{defaultValue:null,description:"",name:"fontFamily",required:!1,type:{name:"string"}},textColor:{defaultValue:null,description:"",name:"textColor",required:!1,type:{name:"string"}},borderWidth:{defaultValue:{value:"0"},description:"",name:"borderWidth",required:!1,type:{name:"number"}},borderColor:{defaultValue:null,description:"",name:"borderColor",required:!1,type:{name:"string"}},labels:{defaultValue:null,description:"",name:"labels",required:!0,type:{name:"string[]"}},counters:{defaultValue:null,description:"",name:"counters",required:!0,type:{name:"CounterType[]"}},countersConfiguration:{defaultValue:null,description:"",name:"countersConfiguration",required:!0,type:{name:"CountersConfigurations"}},labelClicked:{defaultValue:null,description:"",name:"labelClicked",required:!0,type:{name:"(key: string, value: string) => void"}},sizeAxis:{defaultValue:null,description:"",name:"sizeAxis",required:!0,type:{name:"MetadataKeyValue | null"}},colorAxis:{defaultValue:null,description:"",name:"colorAxis",required:!0,type:{name:"CounterType[]"}},nodeActionsClicked:{defaultValue:null,description:"",name:"nodeActionsClicked",required:!0,type:{name:"(node: DataNode) => void"}},translate:{defaultValue:null,description:"",name:"translate",required:!0,type:{name:"boolean"}},totalItems:{defaultValue:null,description:"",name:"totalItems",required:!0,type:{name:"number"}},totalUniqueItemsStats:{defaultValue:null,description:"",name:"totalUniqueItemsStats",required:!1,type:{name:"UniqueItemsStats"}},uniquePropertyName:{defaultValue:null,description:"",name:"uniquePropertyName",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Treemap.tsx#Treemap"]={docgenInfo:Treemap.__docgenInfo,name:"Treemap",path:"src/components/Treemap.tsx#Treemap"})}catch(__react_docgen_typescript_loader_error){}const OneAiAnalytics=({dataNodes={totalItems:0,nodes:[]},currentNode,currentPage=0,totalPagesAmount=0,goBackClicked=()=>{},nodeClicked=()=>{},nextPageClicked=()=>{},prevPageClicked=()=>{},itemsDisplay=ItemsListDisplay,darkMode=!0,background,treemapBigColor=darkMode?"#322F46":"#F7F7F7",treemapSmallColor=darkMode?"#2C293D":"#F7F7F7",treemapCountFontSize=14,fontFamily="'Poppins', sans-serif",textColor=darkMode?"white":"#111111",treemapBorderWidth=1,navbarColor,treemapBorderColor=darkMode?"#272535":"white",barColor=darkMode?"#322F46":"#F7F7F7",loading,error=null,nodesPath=[],dateRangeChanged=()=>{},labelsFilters,labelClicked=()=>{},labelFilterDeleted=()=>{},trendPeriods,trendPeriodsChanged,splitPhrase,mergeClusters,searchSimilarClusters,translationEnabled=!0,customizeEnabled=!0,filterOnlySkills=!1,datePickerEnabled=!0,startDate=null,endDate=null,toggleHide=()=>{},propertiesFilters={},setPropertiesFilters=()=>{},metaOptions,currentMetaOption,metaOptionsChanged=()=>{},refresh=()=>{},uniqueMetaKey:uniquePropertyName})=>{const[display,setDisplay]=(0,react.useState)("Treemap"),{width,height,ref}=(0,index_esm.NB)(),[metaData,setMetaData]=(0,react.useState)({}),[nodes,setNodes]=(0,react.useState)([]),[labels,setLabels]=(0,react.useState)([]),[counters,setCounters]=(0,react.useState)([]),[sizeAxis,setSizeAxis]=(0,react.useState)(null),[colorAxis,setColorAxis]=(0,react.useState)([]),[countersConfigurations,setCountersConfigurations]=(0,react.useState)({}),[currentNodeActions,setCurrentNodeActions]=(0,react.useState)(null),[translate,setTranslate]=(0,react.useState)(!1),[fromDate,setFromDate]=(0,react.useState)(startDate?new Date(startDate):null),[toDate,setToDate]=(0,react.useState)(endDate?new Date(endDate):null),loadedNodes=(0,react.useRef)([]),currentCollection=(0,react.useRef)(null),[currentHoveredNode,setCurrentHoveredNode]=(0,react.useState)(null);return(0,react.useEffect)((()=>{if(!nodesPath||0===nodesPath.length||currentCollection.current===nodesPath[0].text)return;currentCollection.current=nodesPath[0].text,setLabels(JSON.parse(localStorage.getItem(getCurrentStorageKey("oneAi-labels-cache",currentCollection.current))??"[]")),setCounters(getInitialCounterTypes(defaultCalculations,[{metadataKeyValue:{key:CUSTOM_METADATA_KEY},calculationName:"% of all unique items"},{metadataKeyValue:{key:CUSTOM_METADATA_KEY},calculationName:"Total unique items"},{metadataKeyValue:{key:"signals"},calculationName:topGroupPercentCalculationName}],currentCollection.current,"oneAi-counters-cache"));const storedSizeAxis=localStorage.getItem(getCurrentStorageKey("oneAi-sizeAxis-cache",currentCollection.current));setSizeAxis(storedSizeAxis?JSON.parse(storedSizeAxis):{key:CUSTOM_METADATA_KEY}),setColorAxis(getInitialCounterTypes(defaultCalculations,[{metadataKeyValue:{key:"signals",value:"positive"},calculationName:"% of items"},{metadataKeyValue:{key:"signals",value:"negative"},calculationName:"% of items"}],currentCollection.current,"oneAi-colorAxis-cache"))}),[nodesPath]),(0,react.useEffect)((()=>{setMetaData((currentMetadata=>{const newMetadata=currentNode?loadedNodes.current.some((loadedNode=>loadedNode.type===currentNode.type&&loadedNode.id===getNodeId(currentNode)))?currentMetadata:mergeMetadata(currentMetadata,currentNode?.data.metadata??{}):nodes.filter((node=>!loadedNodes.current.some((loadedNode=>loadedNode.id===node.id&&loadedNode.type===node.type)))).reduce(((finalMetadata,currentNode)=>mergeMetadata(finalMetadata,currentNode.metadata)),currentMetadata);return loadedNodes.current.push({type:currentNode?.type??"Collection",id:currentNode?getNodeId(currentNode):"Collection"}),currentNode||loadedNodes.current.push(...nodes.map((node=>({type:node.type,id:node.id})))),newMetadata}))}),[currentNode,nodes]),(0,react.useEffect)((()=>{setNodes(dataNodes.nodes.map((d=>{const itemsCount=function getNodeItemsCount(node){return"Cluster"===node.type||"Phrase"===node.type||"Meta"===node.type?node.data.items_count:1}(d),nodeText=getNodeText(d),{originalText,translatedText}=getNodeOriginalAndTranslatedText(d);return{id:getNodeId(d),amount:itemsCount,text:nodeText,item_original_text:originalText??nodeText,item_translated_text:translatedText,metadata:{[CUSTOM_METADATA_KEY]:[{value:CUSTOM_METADATA_KEY,count:itemsCount}],...d.data.metadata},trends:(node=d,!node||"Cluster"!==node.type&&"Phrase"!==node.type&&"Meta"!==node.type?[]:node.data.trends??[]),type:d.type,properties:d.data.properties,metadata_stats:d.data.metadata_stats};var node})))}),[dataNodes]),(0,react.useEffect)((()=>{const newCountersConfigurations={};Object.keys(metaData).concat(Object.keys(defaultCountersConfigurations)).forEach((key=>{const defaultConfig=defaultCountersConfigurations[key],valuesConfigured=defaultConfig?.items?.map((group=>group.label))??[],counterConfiguration={label:(defaultConfig?.label??key).toLowerCase(),display:defaultConfig?.display,members:defaultConfig?.members??[{metadataName:key}],isGroup:defaultConfig?.isGroup??!1,items:key===CUSTOM_METADATA_KEY?void 0:(defaultConfig?.items?.map((group=>({label:group.label,display:group.display,isGroup:group.isGroup,members:group.members?.map((member=>({metadataName:member.metadataName??key,values:member.values})))??[{metadataName:key,values:[group.label??""]}]})))??[]).concat(metaData[key]?.filter((meta=>!valuesConfigured.includes(meta.value))).map((meta=>({label:meta.value,members:[{metadataName:key,values:[meta.value]}],display:void 0,isGroup:!1})))??[])};newCountersConfigurations[key]=counterConfiguration})),setCountersConfigurations(newCountersConfigurations)}),[metaData]),(0,react.useEffect)((()=>{const storedCounters=counters.map((counter=>({metadataKeyValue:counter.metadataKeyValue,calculationName:counter.calculationConfiguration.name}))),storedColorAxis=colorAxis.map((counter=>({metadataKeyValue:counter.metadataKeyValue,calculationName:counter.calculationConfiguration.name})));currentCollection.current&&(localStorage.setItem(getCurrentStorageKey("oneAi-counters-cache",currentCollection.current),JSON.stringify(storedCounters)),localStorage.setItem(getCurrentStorageKey("oneAi-labels-cache",currentCollection.current),JSON.stringify(labels)),localStorage.setItem(getCurrentStorageKey("oneAi-colorAxis-cache",currentCollection.current),JSON.stringify(storedColorAxis)),localStorage.setItem(getCurrentStorageKey("oneAi-sizeAxis-cache",currentCollection.current),JSON.stringify(sizeAxis)))}),[counters,labels,sizeAxis,colorAxis]),(0,react.useEffect)((()=>{dateRangeChanged(fromDate,toDate)}),[fromDate,toDate]),(0,react.useEffect)((()=>{index_es.Z.hide(),index_es.Z.rebuild()})),(0,jsx_runtime.jsx)("div",{className:"oneai-analytics-namespace h-full w-full overflow-hidden "+(darkMode?"dark":""),children:(0,jsx_runtime.jsxs)("div",{id:"headlessui-portal-root",className:"h-full w-full flex flex-col overflow-hidden bg-[#f3e5e5] dark:bg-[#161414] p-1 "+(darkMode?"dark":""),style:{background},children:[(0,jsx_runtime.jsx)(index_es.Z,{id:"global"}),(0,jsx_runtime.jsx)(index_es.Z,{id:"global-actions",place:"top",effect:"solid",clickable:!0,className:"!p-1",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col w-full h-full items-baseline",children:[(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>{index_es.Z.hide(),setCurrentNodeActions(currentHoveredNode)},className:"text-gray-900 w-full bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 font-medium rounded-lg text-sm px-2 py-2 mr-1 mb-1 dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700",children:"Cluster"===currentHoveredNode?.type?"Merge":"Split"}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>{index_es.Z.hide(),index_es.Z.rebuild(),toggleHide(currentHoveredNode,"true"===currentHoveredNode?.properties?.hide?"false":"true")},className:"text-gray-900 w-full bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 font-medium rounded-lg text-sm px-2 py-2 mr-1 mb-1 dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700",children:"true"===currentHoveredNode?.properties?.hide?"Show":"Hide"})]})}),(0,jsx_runtime.jsx)(ItemActions,{node:currentNodeActions,splitPhrase,mergeClusters,searchSimilarClusters,translationEnabled:translate}),(0,jsx_runtime.jsx)("div",{className:"w-full rounded-t-md border-b border-[#322F46] bg-white dark:bg-[#272535]",style:{height:"65px",background:navbarColor,fontFamily},children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-row items-center py-6 ml-[24px] h-full",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row w-5/12 justify-start items-center",children:[(0,jsx_runtime.jsxs)("div",{className:"h-full flex",children:[(0,jsx_runtime.jsxs)("svg",{className:getVisualizationLogoClasses("Treemap"===display),onClick:()=>setDisplay("Treemap"),width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:[(0,jsx_runtime.jsx)("path",{d:"M3.5 5.89477C3.5 5.06635 4.17157 4.39478 5 4.39478H19C19.8284 4.39478 20.5 5.06635 20.5 5.89478V11.9211H3.5V5.89477Z"}),(0,jsx_runtime.jsx)("path",{d:"M3.5 11.9736H13.8684V19.4999H5C4.17157 19.4999 3.5 18.8284 3.5 17.9999V11.9736Z"}),(0,jsx_runtime.jsx)("path",{d:"M13.9211 11.9736H20.5001V17.9999C20.5001 18.8284 19.8285 19.4999 19.0001 19.4999H13.9211V11.9736Z"}),(0,jsx_runtime.jsx)("path",{d:"M8.68433 4.36841V11.4737"})]}),(0,jsx_runtime.jsxs)("svg",{className:getVisualizationLogoClasses("BarChart"===display),onClick:()=>setDisplay("BarChart"),width:"24",height:"24",viewBox:"0 0 24 24",stroke:"currentColor",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,jsx_runtime.jsx)("path",{d:"M3.75 20.25V3.75"}),(0,jsx_runtime.jsx)("path",{d:"M3.75 9.75H15.75C15.75 11.5074 15.75 12.4926 15.75 14.25H3.75"}),(0,jsx_runtime.jsx)("path",{d:"M20.25 5.25H3.75V9.75H20.25V5.25Z"}),(0,jsx_runtime.jsx)("path",{d:"M12.75 14.25V18.75H3.75"})]})]}),datePickerEnabled?(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(DatesFilters,{fromDate,fromDateChanged:setFromDate,toDate,toDateChanged:setToDate,trendPeriods,trendPeriodsChanged})}):null,(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(LabelsFiltersSelect,{filterOnlySkills,selectedLabels:labelsFilters??[],countersConfigurations,labelFilterDeleted,selectedMetadataKeyValueChange:metadataKeyValue=>labelClicked(metadataKeyValue.key,metadataKeyValue.value)})}),customizeEnabled?(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(CustomizeTab,{currentCounters:counters,selectedLabels:labels,countersConfigurations,labelsOptions:Object.keys(metaData).filter((key=>key!==CUSTOM_METADATA_KEY)),calculationsConfigurations:defaultCalculations,countersChanged:setCounters,labelsChanged:setLabels,selectedSizeAxis:sizeAxis,sizeAxisChanged:setSizeAxis,currentColorsAxis:colorAxis,colorsAxisChanged:setColorAxis})}):null]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-row w-full justify-end items-center",children:[(0,jsx_runtime.jsx)(ArrowPathIcon.Z,{onClick:refresh,"data-for":"global","data-tip":"Refresh data",className:"h-6 w-6 p-1 mr-1 hover:cursor-pointer focus:outline-none text-[#747189] dark:hover:text-white"}),"true"===propertiesFilters.hide?(0,jsx_runtime.jsx)(EyeIcon.Z,{onClick:()=>setPropertiesFilters({hide:"false"}),"data-for":"global","data-tip":"Show hidden nodes",className:"h-6 w-6 p-1 mr-1 hover:cursor-pointer focus:outline-none text-[#747189] dark:hover:text-white"}):(0,jsx_runtime.jsx)(EyeSlashIcon.Z,{onClick:()=>setPropertiesFilters({hide:"true"}),"data-for":"global","data-tip":"Hide hidden nodes",className:"h-6 w-6 p-1 mr-1 hover:cursor-pointer focus:outline-none bg-[#EFEFEF] dark:text-white dark:bg-[#322F46]"}),translationEnabled?(0,jsx_runtime.jsx)(LanguageIcon.Z,{onClick:()=>setTranslate((translate=>!translate)),"data-for":"global","data-tip":translate?"Disable translation":"Enable translation",className:"h-6 w-6 p-1 mr-1 hover:cursor-pointer focus:outline-none "+(translate?"bg-[#EFEFEF] dark:text-white dark:bg-[#322F46]":"text-[#747189] hover:cursor-pointer dark:hover:text-white")}):null]})]})}),(0,jsx_runtime.jsxs)("div",{className:"w-full grow flex flex-col overflow-hidden bg-white dark:bg-[#272535]",style:{background:navbarColor},children:[(0,jsx_runtime.jsx)("div",{className:"w-full",style:{height:"65px",fontFamily},children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-row items-center ml-[24px] h-full",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row justify-start mr-4 items-center w-full",style:{fontFamily,fontWeight:300,fontStyle:"normal",fontSize:"14px"},children:[(0,jsx_runtime.jsxs)("button",{type:"button",onClick:()=>goBackClicked(1),disabled:null===currentNode,className:"rounded-lg inline-flex "+(currentNode?"hover:bg-[#EFEFEF] dark:hover:bg-slate-700":"hover:cursor-default"),children:[currentNode?(0,jsx_runtime.jsxs)("svg",{className:"h-[1em] w-[1em] self-center text-[#111111] dark:text-white",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[" ",(0,jsx_runtime.jsx)("path",{stroke:"none",d:"M0 0h24v24H0z"})," ",(0,jsx_runtime.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})," ",(0,jsx_runtime.jsx)("line",{x1:"5",y1:"12",x2:"9",y2:"16"})," ",(0,jsx_runtime.jsx)("line",{x1:"5",y1:"12",x2:"9",y2:"8"})]}):(0,jsx_runtime.jsx)(HomeIcon.Z,{className:"h-[0.9em] w-[1em] text-[#111111] dark:text-white"}),(0,jsx_runtime.jsx)("span",{className:"sr-only",children:"Go back"})]}),(0,jsx_runtime.jsxs)("div",{className:"ml-1 text-[#111111] dark:text-gray-300 truncate flex items-center",children:[nodesPath.map(((node,i)=>(0,jsx_runtime.jsxs)("div",{className:"flex",children:[(0,jsx_runtime.jsx)("div",{className:"max-w-[50ch] truncate",children:(0,jsx_runtime.jsx)("span",{className:"cursor-pointer hover:text-gray-600 dark:hover:text-gray-50",onClick:()=>goBackClicked(0===i?nodesPath.length:nodesPath.length-1-i),dir:"auto",children:translate&&node.translated?node.translated:node.text})}),nodesPath.length-1!==i&&(0,jsx_runtime.jsx)("span",{className:"ml-1 mr-1",children:"/"})]},i))),metaOptions&&1===nodesPath.length?(0,jsx_runtime.jsxs)("span",{className:"ml-1 flex text-[#111111] dark:text-gray-300",children:[(0,jsx_runtime.jsx)("span",{className:"mr-1",children:"/ "}),(0,jsx_runtime.jsx)(SingleSelect,{options:metaOptions,selectedLabel:currentMetaOption??"text",onSelect:metaOptionsChanged})]}):null,(labelsFilters?.length??0)>0&&labelsFilters?.filter((label=>label.value)).map(((keyValue,i)=>(0,jsx_runtime.jsxs)("span",{className:"flex items-center",children:[(0,jsx_runtime.jsx)("span",{className:"text-gray-500 ml-1",children:"/ "}),(0,jsx_runtime.jsx)(LabelDisplay,{metadataKey:keyValue.key,value:keyValue.value??"",countersConfiguration:countersConfigurations,labelClicked:()=>{},maxWidth:"20ch",color:"#747189"}),(0,jsx_runtime.jsxs)("button",{type:"button",onClick:()=>labelFilterDeleted(i),children:[(0,jsx_runtime.jsx)(XMarkIcon.Z,{className:"h-4 w-4 text-gray-400 hover:scale-125 transition duration-100 ease-linear"}),(0,jsx_runtime.jsx)("span",{className:"sr-only",children:"Delete label filter"})]})]},i))),totalPagesAmount>1&&currentPage>0&&(0,jsx_runtime.jsxs)("span",{className:"ml-1 text-gray-500",children:["/ ",currentPage+1]})]})]}),(0,jsx_runtime.jsx)("div",{children:!loading&&(0,jsx_runtime.jsx)(CountersLabelsDisplay,{counters,labels,metadata:nodes.reduce(((finalMetadata,currentNode)=>mergeMetadata(finalMetadata,currentNode.metadata,dataNodes.totalItems)),{}),trends:nodes.reduce(((finalMetadata,currentNode)=>function mergeTrends(trends1,trends2){if(!trends1||!trends2)return[];const newTrends=[],sourceTrends=trends1.length>=trends2.length?trends1:trends2;return sourceTrends.forEach(((_,i)=>{newTrends.push({days:sourceTrends[i].days,period_start_date:sourceTrends[i].period_start_date,period_end_date:sourceTrends[i].period_end_date,items_count:(trends1.at(i)?.items_count??0)+(trends2.at(i)?.items_count??0),phrases_count:(trends1.at(i)?.phrases_count??0)+(trends2.at(i)?.phrases_count??0),metadata:mergeMetadata(trends1.at(i)?.metadata??{},trends2.at(i)?.metadata??{})})})),newTrends}(finalMetadata,currentNode.trends)),[]),countersConfiguration:countersConfigurations,labelClicked,totalItems:dataNodes.totalItems,totalUniqueItemsStats:dataNodes.uniqueItemsStats,uniqueItemsStats:dataNodes.uniqueItemsStats,uniquePropertyName})})]})}),(0,jsx_runtime.jsxs)("div",{className:"w-full h-full flex flex-col overflow-x-hidden",children:[loading&&(0,jsx_runtime.jsx)("div",{className:"grow w-full justify-center items-center flex",children:(0,jsx_runtime.jsx)("div",{className:"text-center",children:(0,jsx_runtime.jsxs)("div",{role:"status",children:[(0,jsx_runtime.jsxs)("svg",{className:"inline mr-2 w-8 h-8 text-gray-200 animate-spin fill-blue-600",viewBox:"0 0 100 101",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,jsx_runtime.jsx)("path",{d:"M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z",fill:"currentColor"}),(0,jsx_runtime.jsx)("path",{d:"M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z",fill:"currentFill"})]}),(0,jsx_runtime.jsx)("span",{className:"sr-only",children:"Loading..."})]})})}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-row flex-grow "+(loading?"invisible pointer-events-none w-0 h-0":"w-full h-full"),children:[currentPage>0&&(0,jsx_runtime.jsx)("div",{className:"h-full flex items-center justify-center hover:cursor-pointer dark:bg-[#322F46]",onClick:prevPageClicked,style:{width:"3%",backgroundColor:treemapBigColor},children:(0,jsx_runtime.jsxs)("button",{type:"button",className:"text-slate-500 hover:text-slate-700 font-medium rounded-lg text-sm text-center inline-flex items-center",children:[(0,jsx_runtime.jsx)("svg",{"aria-hidden":"true",className:"w-5 h-5 rotate-180",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,jsx_runtime.jsx)("path",{fillRule:"evenodd",d:"M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z",clipRule:"evenodd"})}),(0,jsx_runtime.jsx)("span",{className:"sr-only",children:"Prev"})]})}),(0,jsx_runtime.jsx)("div",{ref,className:"h-full w-full overflow-y-auto no-scrollbar overflow-x-hidden",children:null!==error||0===dataNodes.totalItems?(0,jsx_runtime.jsxs)("p",{className:"h-full w-full ml-[24px] dark:text-white",children:[error,0===dataNodes.totalItems?(labelsFilters?.length??0)>0?(0,jsx_runtime.jsxs)("span",{className:"flex flex-col",children:[(0,jsx_runtime.jsx)("span",{children:"No items match your filter:"}),labelsFilters?.map((labelFilter=>(0,jsx_runtime.jsxs)("span",{children:[labelFilter.key,labelFilter.value?`=${labelFilter.value}`:""]})))]}):" Collection is empty":null]}):currentNode&&"Phrase"===currentNode.type?itemsDisplay({items:dataNodes.nodes.map((dataNode=>dataNode.data)),bgColor:navbarColor,textColor,counters,labels,labelClicked,countersConfiguration:countersConfigurations,translate,totalItems:dataNodes.totalItems}):"Treemap"===display?(0,jsx_runtime.jsx)(Treemap,{dataNodes:nodes,height:height??0,width:width??0,nodeClicked:node=>{index_es.Z.hide(),nodeClicked({type:currentNode?"Cluster"===currentNode.type?"Phrase":"Item":"Cluster",id:node.id})},labels,counters,bigColor:treemapBigColor,smallColor:treemapSmallColor,countFontSize:treemapCountFontSize,fontFamily,textColor,borderWidth:treemapBorderWidth,borderColor:treemapBorderColor,countersConfiguration:countersConfigurations,labelClicked,sizeAxis,colorAxis,nodeActionsClicked:node=>{setCurrentHoveredNode({type:currentNode?"Cluster"===currentNode.type?"Phrase":"Item":"Cluster",id:node.id,text:node.text??"",properties:node.properties})},translate,totalItems:dataNodes.totalItems,totalUniqueItemsStats:dataNodes.uniqueItemsStats,uniquePropertyName}):(0,jsx_runtime.jsx)(BarChart,{dataNodes:nodes,height:height??0,width:width??0,nodeClicked:node=>{index_es.Z.hide(),nodeClicked({type:currentNode?"Cluster"===currentNode.type?"Phrase":"Item":"Cluster",id:node.id})},fontFamily,textColor,barColor,labels,counters,countersConfiguration:countersConfigurations,labelClicked,sizeAxis,colorAxis,nodeActionsClicked:node=>{setCurrentHoveredNode({type:currentNode?"Cluster"===currentNode.type?"Phrase":"Item":"Cluster",id:node.id,text:node.text??"",properties:node.properties})},translate,totalItems:dataNodes.totalItems,totalUniqueItemsStats:dataNodes.uniqueItemsStats,uniquePropertyName})}),currentPage<totalPagesAmount-1&&(0,jsx_runtime.jsx)("div",{className:"h-full flex items-center justify-center hover:cursor-pointer",onClick:nextPageClicked,style:{width:"3%",backgroundColor:treemapSmallColor},children:(0,jsx_runtime.jsxs)("button",{type:"button",className:"text-slate-500 hover:text-slate-700 font-medium rounded-lg text-sm text-center inline-flex items-center",children:[(0,jsx_runtime.jsx)("svg",{"aria-hidden":"true",className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,jsx_runtime.jsx)("path",{fillRule:"evenodd",d:"M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z",clipRule:"evenodd"})}),(0,jsx_runtime.jsx)("span",{className:"sr-only",children:"Next"})]})})]})]})]})]})})};function getVisualizationLogoClasses(active){return"h-7 w-7 mr-1 p-1 rounded-md "+(active?"bg-[#EFEFEF] dark:text-white dark:bg-[#322F46]":"text-[#747189] hover:cursor-pointer dark:hover:text-white")}function mergeMetadata(metadata1,metadata2,totalItems){const newMetadata={};return Array.from(new Set([...Object.keys(metadata1),...Object.keys(metadata2)])).forEach((key=>{void 0!==totalItems&&key===CUSTOM_METADATA_KEY||(newMetadata[key]=[...metadata1[key]??[],...metadata2[key]??[]])})),void 0===totalItems||(newMetadata[CUSTOM_METADATA_KEY]=[{value:CUSTOM_METADATA_KEY,count:totalItems}]),newMetadata}function getInitialCounterTypes(calculationConfiguration,defaultCounters,collection,storageKey){const storedCounters=JSON.parse(localStorage.getItem(getCurrentStorageKey(storageKey,collection))??"[]");return(storedCounters.length>0?storedCounters:defaultCounters).map((counter=>({calculationConfiguration:calculationConfiguration.find((calc=>calc.name===counter.calculationName)),metadataKeyValue:counter.metadataKeyValue}))).filter((calc=>void 0!==calc.calculationConfiguration))}function getCurrentStorageKey(prefix,collection){return`${prefix}-${collection}`}OneAiAnalytics.displayName="OneAiAnalytics";try{OneAiAnalytics.displayName="OneAiAnalytics",OneAiAnalytics.__docgenInfo={description:"One Ai Analytics Component",displayName:"OneAiAnalytics",props:{dataNodes:{defaultValue:{value:"{ totalItems: 0, nodes: [] }"},description:"",name:"dataNodes",required:!1,type:{name:"{ totalItems: number; uniqueItemsStats?: UniqueItemsStats; nodes: OneAIDataNode[]; }"}},currentNode:{defaultValue:null,description:"",name:"currentNode",required:!1,type:{name:"OneAIDataNode"}},totalPagesAmount:{defaultValue:{value:"0"},description:"",name:"totalPagesAmount",required:!1,type:{name:"number"}},currentPage:{defaultValue:{value:"0"},description:"",name:"currentPage",required:!1,type:{name:"number"}},nodeClicked:{defaultValue:{value:"() => {}"},description:"",name:"nodeClicked",required:!1,type:{name:'((node: Omit<OneAIDataNode & { id: string; }, "data">) => void)'}},goBackClicked:{defaultValue:{value:"() => {}"},description:"",name:"goBackClicked",required:!1,type:{name:"((skip: number) => void)"}},nextPageClicked:{defaultValue:{value:"() => {}"},description:"",name:"nextPageClicked",required:!1,type:{name:"(() => void)"}},prevPageClicked:{defaultValue:{value:"() => {}"},description:"",name:"prevPageClicked",required:!1,type:{name:"(() => void)"}},itemsDisplay:{defaultValue:{value:'({\n  items,\n  bgColor,\n  textColor,\n  counters,\n  labels,\n  countersConfiguration,\n  labelClicked,\n  translate,\n  totalItems,\n}) => {\n  return (\n    <div\n      className="overflow-x-auto text-black bg-[#F7F7F7] dark:bg-[#272535] dark:text-white"\n      style={{ backgroundColor: bgColor, color: textColor }}\n    >\n      <table className="table-auto w-full h-full text-left">\n        <thead className="border-b-2 border-b-slate-500">\n          <tr>\n            <th className="p-1">Items</th>\n            <th className="p-1">Time</th>\n            {counters\n              .filter(\n                (counter) =>\n                  counter.metadataKeyValue?.key !== CUSTOM_METADATA_KEY\n              )\n              .map((counter, i) => (\n                <th className="p-1 lowercase first-letter:uppercase" key={i}>\n                  {counter.metadataKeyValue\n                    ? getMetadataKeyValueDisplay(counter.metadataKeyValue)\n                    : \'\'}\n                </th>\n              ))}\n            {labels.map((label, i) => (\n              <th className="p-1 lowercase first-letter:uppercase" key={i}>\n                {label}\n              </th>\n            ))}\n          </tr>\n        </thead>\n        <tbody>\n          {items.map((item, i) => {\n            const item_date = parseDate(item.item_timestamp);\n            return (\n              <tr key={i}>\n                <td className="max-w-[60ch] truncate p-1">\n                  {translate &&\n                  item.item_translated_text !== undefined &&\n                  item.item_translated_text !== null &&\n                  item.item_translated_text !== \'\'\n                    ? item.item_translated_text\n                    : item.original_text}\n                </td>\n                <td\n                  className="p-1"\n                  data-for="global"\n                  data-tip={item_date}\n                  style={{ width: \'1em\', height: \'1em\' }}\n                >\n                  {item_date.split(\' \').at(0)}\n                </td>\n                {counters\n                  .filter(\n                    (counter) =>\n                      counter.metadataKeyValue?.key !== CUSTOM_METADATA_KEY\n                  )\n                  .map((counter, i) => (\n                    <td key={i} className="p-1">\n                      <CounterDisplay\n                        counter={counter}\n                        countersConfiguration={countersConfiguration}\n                        metadata={item.metadata}\n                        trends={[]}\n                        totalItems={totalItems}\n                      />\n                    </td>\n                  ))}\n                {labels.map((label, i) => (\n                  <td key={i}>\n                    <MaxLabelDisplay\n                      metadataKey={label}\n                      labelClicked={labelClicked}\n                      countersConfiguration={countersConfiguration}\n                      metadata={item.metadata}\n                    />\n                  </td>\n                ))}\n              </tr>\n            );\n          })}\n        </tbody>\n      </table>\n    </div>\n  );\n}'},description:"",name:"itemsDisplay",required:!1,type:{name:"FC<ItemsDisplayComponentProps>"}},loading:{defaultValue:null,description:"",name:"loading",required:!1,type:{name:"boolean"}},error:{defaultValue:{value:"null"},description:"",name:"error",required:!1,type:{name:"string | null"}},nodesPath:{defaultValue:{value:"[]"},description:"",name:"nodesPath",required:!1,type:{name:"{ text: string; translated?: string | null; }[]"}},dateRangeChanged:{defaultValue:{value:"() => {}"},description:"",name:"dateRangeChanged",required:!1,type:{name:"((from: Date | null, to: Date | null) => void)"}},labelsFilters:{defaultValue:null,description:"",name:"labelsFilters",required:!1,type:{name:"MetadataKeyValue[]"}},setLabelsFilters:{defaultValue:null,description:"",name:"setLabelsFilters",required:!1,type:{name:"Dispatch<SetStateAction<MetadataKeyValue[]>>"}},labelClicked:{defaultValue:{value:"() => {}"},description:"",name:"labelClicked",required:!1,type:{name:"((key: string, value: string) => void)"}},labelFilterDeleted:{defaultValue:{value:"() => {}"},description:"",name:"labelFilterDeleted",required:!1,type:{name:"((index: number) => void)"}},trendPeriods:{defaultValue:null,description:"",name:"trendPeriods",required:!1,type:{name:"number"}},trendPeriodsChanged:{defaultValue:null,description:"",name:"trendPeriodsChanged",required:!1,type:{name:"((index: number) => void)"}},searchSimilarClusters:{defaultValue:null,description:"",name:"searchSimilarClusters",required:!1,type:{name:"((text: string, controller: AbortController) => Promise<{ id: string; text: string; translation: string | null; }[]>)"}},splitPhrase:{defaultValue:null,description:"",name:"splitPhrase",required:!1,type:{name:'((phraseId: string, controller: AbortController) => Promise<{ status: "error" | "Success"; message: string; }>)'}},mergeClusters:{defaultValue:null,description:"",name:"mergeClusters",required:!1,type:{name:'((source: string[], destination: string, controller: AbortController) => Promise<{ status: "error" | "Success"; message: string; }>)'}},toggleHide:{defaultValue:{value:"() => {}"},description:"",name:"toggleHide",required:!1,type:{name:"((node: { type: NodeType; id: string; text: string; properties: Properties; } | null, hide: string) => void)"}},propertiesFilters:{defaultValue:{value:"{}"},description:"",name:"propertiesFilters",required:!1,type:{name:"Properties"}},setPropertiesFilters:{defaultValue:{value:"() => {}"},description:"",name:"setPropertiesFilters",required:!1,type:{name:"((properties: Properties) => void)"}},metaOptions:{defaultValue:null,description:"",name:"metaOptions",required:!1,type:{name:"string[]"}},currentMetaOption:{defaultValue:null,description:"",name:"currentMetaOption",required:!1,type:{name:"string"}},metaOptionsChanged:{defaultValue:{value:"() => {}"},description:"",name:"metaOptionsChanged",required:!1,type:{name:"((option: string) => void)"}},refresh:{defaultValue:{value:"() => {}"},description:"",name:"refresh",required:!1,type:{name:"(() => void)"}},darkMode:{defaultValue:{value:"true"},description:"",name:"darkMode",required:!1,type:{name:"boolean"}},background:{defaultValue:null,description:"",name:"background",required:!1,type:{name:"string"}},treemapBigColor:{defaultValue:{value:"darkMode ? '#322F46' : '#F7F7F7'"},description:"",name:"treemapBigColor",required:!1,type:{name:"string"}},treemapSmallColor:{defaultValue:{value:"darkMode ? '#2C293D' : '#F7F7F7'"},description:"",name:"treemapSmallColor",required:!1,type:{name:"string"}},treemapCountFontSize:{defaultValue:{value:"14"},description:"",name:"treemapCountFontSize",required:!1,type:{name:"number"}},fontFamily:{defaultValue:{value:"'Poppins', sans-serif"},description:"",name:"fontFamily",required:!1,type:{name:"string"}},textColor:{defaultValue:{value:"darkMode ? 'white' : '#111111'"},description:"",name:"textColor",required:!1,type:{name:"string"}},treemapBorderWidth:{defaultValue:{value:"1"},description:"",name:"treemapBorderWidth",required:!1,type:{name:"number"}},treemapBorderColor:{defaultValue:{value:"darkMode ? '#272535' : 'white'"},description:"",name:"treemapBorderColor",required:!1,type:{name:"string"}},navbarColor:{defaultValue:null,description:"",name:"navbarColor",required:!1,type:{name:"string"}},barColor:{defaultValue:{value:"darkMode ? '#322F46' : '#F7F7F7'"},description:"",name:"barColor",required:!1,type:{name:"string"}},translationEnabled:{defaultValue:{value:"true"},description:"",name:"translationEnabled",required:!1,type:{name:"boolean"}},customizeEnabled:{defaultValue:{value:"true"},description:"",name:"customizeEnabled",required:!1,type:{name:"boolean"}},filterOnlySkills:{defaultValue:{value:"false"},description:"",name:"filterOnlySkills",required:!1,type:{name:"boolean"}},datePickerEnabled:{defaultValue:{value:"true"},description:"",name:"datePickerEnabled",required:!1,type:{name:"boolean"}},startDate:{defaultValue:{value:"null"},description:"",name:"startDate",required:!1,type:{name:"string"}},endDate:{defaultValue:{value:"null"},description:"",name:"endDate",required:!1,type:{name:"string"}},uniqueMetaKey:{defaultValue:null,description:"",name:"uniqueMetaKey",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/OneAiAnalytics.tsx#OneAiAnalytics"]={docgenInfo:OneAiAnalytics.__docgenInfo,name:"OneAiAnalytics",path:"src/components/OneAiAnalytics.tsx#OneAiAnalytics"})}catch(__react_docgen_typescript_loader_error){}const cache=new Map,nodeToPageCache=new Map,OneAIAnalyticsApiWrapper=({domain="prod",apiKey="",collection="",collectionDisplayName=collection,refreshToken="",uniqueMetaKey:uniquePropertyName,datePickerEnabled=!0,customizeEnabled=!0,filterOnlySkills=!1,startDate,endDate,...rest})=>{domain=(0,externalInputs.q)(domain);const[loading,setLoading]=(0,react.useState)(!0),[error,setError]=(0,react.useState)(null),[currentNodes,setCurrentNodes]=(0,react.useState)({totalItems:0,nodes:[]}),[clickedNodes,setClickedNodes]=(0,react.useState)([]),[currentPage,setCurrentPage]=(0,react.useState)(0),[totalPages,setTotalPages]=(0,react.useState)(0),[dateRange,setDateRange]=(0,react.useState)([startDate?new Date(startDate):null,endDate?new Date(endDate):null]),[labelsFilters,setLabelsFilters]=(0,react.useState)([]),[localRefreshToken,setLocalRefreshToken]=(0,react.useState)(refreshToken),[trendPeriods,setTrendPeriods]=(0,react.useState)(0),[propertiesFilters,setPropertiesFilters]=(0,react.useState)({hide:"true"}),[metaOptions,setMetaOptions]=(0,react.useState)([]),[currentMetaGroup,setCurrentMetaGroup]=(0,react.useState)("text"),[metaGroupClicked,setMetaGroupClicked]=(0,react.useState)(null),previousValues=(0,react.useRef)({domain:null,apiKey:null,collection:null,refreshToken:null,localRefreshToken:null,clickedNodes:null,currentPage:null,lastMetaGroup:"text",startDate:"",endDate:""});(0,react.useEffect)((()=>{previousValues.current.domain===domain&&previousValues.current.apiKey===apiKey&&previousValues.current.collection===collection&&previousValues.current.refreshToken===refreshToken&&previousValues.current.lastMetaGroup===currentMetaGroup&&previousValues.current.startDate===startDate&&previousValues.current.endDate===endDate||(setCurrentNodes({totalItems:0,nodes:[]}),setDateRange([startDate?new Date(startDate):null,endDate?new Date(endDate):null]),setClickedNodes([]),setCurrentPage(0),cache.clear(),previousValues.current={...previousValues.current,domain,apiKey,collection,refreshToken,clickedNodes:null,currentPage:null,lastMetaGroup:currentMetaGroup,startDate,endDate})}),[domain,apiKey,collection,refreshToken,currentMetaGroup,startDate,endDate]),(0,react.useEffect)((()=>{const fetchData=async controller=>{setLoading(!0);const currentClicked=clickedNodes.at(-1);if("text"===currentMetaGroup||currentClicked)if(currentClicked){if("Cluster"===currentClicked.type){const clusterId=currentClicked.data.cluster_id.toString(),cached=getNodesFromCache(currentClicked.type,clusterId,currentPage);if(cached)setTotalPages(cached.totalPages),setCurrentNodes({totalItems:cached.totalItems,uniqueItemsStats:cached.uniqueItemsStats,nodes:cached.nodes});else{const phrases=await async function fetchPhrases(controller,domain,collection,clusterId,apiKey,page,from,to,labelsFilters,trendPeriods,propertiesFilters,uniqueMetaData){return await fetchApi(controller,`${domain}/clustering/v1/collections/${collection}/clusters/${clusterId}/phrases`,apiKey,"phrases",page,from,to,labelsFilters,trendPeriods,propertiesFilters,uniqueMetaData.length>0?"&include-metadata-stats=true&include-metadata-stats-names="+uniqueMetaData.join(","):"")}(controller,domain,collection,clusterId,apiKey,currentPage,dateRange[0],dateRange[1],[...labelsFilters,...metaGroupClicked?[metaGroupClicked]:[]],trendPeriods,propertiesFilters,uniquePropertyName?[uniquePropertyName]:[]);if(phrases.error){if(phrases.error.includes("AbortError"))return;return setError(phrases.error),setLoading(!1)}setError(null);const newNodes=phrases.data.map((p=>({type:"Phrase",data:p})));clickedNodes.at(-1)==currentClicked&&(setCurrentNodes({totalItems:phrases.totalItems,uniqueItemsStats:phrases.uniqueItemsStats,nodes:newNodes}),setTotalPages(phrases.totalPages)),setNodesDataInCache(currentClicked.type,clusterId,currentPage,newNodes,phrases.totalPages,phrases.totalItems,phrases.uniqueItemsStats)}}else if("Phrase"===currentClicked.type){const phraseId=currentClicked.data.phrase_id.toString(),cached=getNodesFromCache(currentClicked.type,phraseId,currentPage);if(cached)setTotalPages(cached.totalPages),setCurrentNodes({totalItems:cached.totalItems,nodes:cached.nodes});else{const items=await async function fetchItems(controller,domain,collection,phraseId,apiKey,page,from,to,labelsFilters,trendPeriods,propertiesFilters){return await fetchApi(controller,`${domain}/clustering/v1/collections/${collection}/phrases/${phraseId}/items`,apiKey,"items",page,from,to,labelsFilters,trendPeriods,propertiesFilters)}(controller,domain,collection,phraseId,apiKey,currentPage,dateRange[0],dateRange[1],[...labelsFilters,...metaGroupClicked?[metaGroupClicked]:[]],trendPeriods,propertiesFilters);if(items.error){if(items.error.includes("AbortError"))return;return setError(items.error),setLoading(!1)}setError(null);const newNodes=items.data.map((i=>({type:"Item",data:i})));clickedNodes.at(-1)==currentClicked&&(setCurrentNodes({totalItems:items.totalItems,nodes:newNodes}),setTotalPages(items.totalPages)),setNodesDataInCache(currentClicked.type,phraseId,currentPage,newNodes,items.totalPages,items.totalItems)}}}else{const cached=getNodesFromCache("Collection",collection,currentPage);if(cached)setTotalPages(cached.totalPages),setCurrentNodes({totalItems:cached.totalItems,uniqueItemsStats:cached.uniqueItemsStats,nodes:cached.nodes});else{const clusters=await async function fetchClusters(controller,domain,collection,apiKey,page,from,to,labelsFilters,trendPeriods,propertiesFilters,uniqueMetaData){return await fetchApi(controller,`${domain}/clustering/v1/collections/${collection}/clusters`,apiKey,"clusters",page,from,to,labelsFilters,trendPeriods,propertiesFilters,uniqueMetaData.length>0?"&include-metadata-stats=true&include-metadata-stats-names="+uniqueMetaData.join(","):"")}(controller,domain,collection,apiKey,currentPage,dateRange[0],dateRange[1],[...labelsFilters,...metaGroupClicked?[metaGroupClicked]:[]],trendPeriods,propertiesFilters,uniquePropertyName?[uniquePropertyName]:[]);if(clusters.error){if(clusters.error.includes("AbortError"))return;return setError(clusters.error),setLoading(!1)}setError(null);const newNodes=clusters.data.map((c=>({type:"Cluster",data:c})));clickedNodes.at(-1)==currentClicked&&(setCurrentNodes({totalItems:clusters.totalItems,uniqueItemsStats:clusters.uniqueItemsStats,nodes:newNodes}),setTotalPages(clusters.totalPages)),setNodesDataInCache("Collection",collection,currentPage,newNodes,clusters.totalPages,clusters.totalItems,clusters.uniqueItemsStats)}}else{const cached=getNodesFromCache("Collection",collection+"_meta",currentPage);if(cached)setCurrentNodes({totalItems:cached.totalItems,nodes:cached.nodes}),setTotalPages(cached.totalPages);else{const metaClusters=await fetchMetaClustersApi(controller,domain,collection,apiKey,0,dateRange[0],dateRange[1],labelsFilters,trendPeriods,propertiesFilters,currentMetaGroup);if(metaClusters.error){if(metaClusters.error.includes("AbortError"))return;return setError(metaClusters.error),setLoading(!1)}setError(null);const newNodes=metaClusters.data.sort(((m1,m2)=>m2.items_count-m1.items_count)).map((c=>({type:"Meta",data:c}))),totalPages=Math.ceil(metaClusters.data.length/PAGE_SIZE),totalItems=metaClusters.data.reduce(((prev,current)=>prev+current.items_count),0),slicedNodes=newNodes.slice(currentPage*PAGE_SIZE,(currentPage+1)*PAGE_SIZE);clickedNodes.at(-1)==currentClicked&&(setCurrentNodes({totalItems,nodes:slicedNodes}),setTotalPages(totalPages)),setNodesDataInCache("Collection",collection+"_meta",currentPage,slicedNodes,totalPages,totalItems)}}setLoading(!1)},controller=new AbortController;return previousValues.current.domain===domain&&previousValues.current.apiKey===apiKey&&previousValues.current.collection===collection&&previousValues.current.clickedNodes==clickedNodes&&previousValues.current.currentPage===currentPage&&previousValues.current.localRefreshToken===localRefreshToken&&previousValues.current.lastMetaGroup===currentMetaGroup||(cache.clear(),(async controller=>{const metaClusters=await fetchMetaClustersApi(controller,domain,collection,apiKey,0,dateRange[0],dateRange[1],labelsFilters,trendPeriods,propertiesFilters),newNodes=metaClusters?.data?.map((c=>({type:"Meta",data:c}))),mappedNodes=newNodes?.map((n=>n.data.meta_key))??[];setMetaOptions(mappedNodes)})(controller).catch((e=>{console.error(e)})),fetchData(controller).catch((e=>{console.error(e),setLoading(!1)})),previousValues.current={...previousValues.current,domain,collection,apiKey,localRefreshToken,clickedNodes,currentPage,lastMetaGroup:currentMetaGroup}),()=>{controller.abort()}}),[domain,collection,apiKey,localRefreshToken,clickedNodes,currentPage,currentMetaGroup]);return currentNodes?(0,jsx_runtime.jsx)(OneAiAnalytics,{dataNodes:currentNodes??{totalItems:0,nodes:[]},currentNode:clickedNodes.at(-1),nodeClicked:node=>{const currentNodeDetails=getNodeDetails(clickedNodes.at(-1),collection);if("text"!==currentMetaGroup)return setLocalRefreshToken((current=>{const[key,value]=node.id.split("$$");return setMetaGroupClicked({key,value}),setCurrentMetaGroup("text"),current.length>2?"1":current+"1"}));!function setNodePageNumberInCache(nodeType,nodeId,page){nodeToPageCache.set(assembleCacheId(nodeType,nodeId),page)}(currentNodeDetails.type,currentNodeDetails.id,currentPage);let clickedNode=null;if("Cluster"===node.type?clickedNode=currentNodes.nodes.find((n=>n.data.cluster_id.toString()===node.id))??null:"Phrase"===node.type&&(clickedNode=currentNodes.nodes.find((n=>n.data.phrase_id.toString()===node.id))??null),clickedNode){const nodeCachedPage=getNodePageNumberFromCache(clickedNode.type,getNodeId(clickedNode));setCurrentPage(nodeCachedPage),setClickedNodes((currentClickedCluster=>[...currentClickedCluster,clickedNode]))}},goBackClicked:(skip=1)=>{0!==skip?setClickedNodes((clickedClusters=>{const originalClickedAmount=clickedClusters.length;for(let i=0;i<skip;i++)clickedClusters.pop();const currentNodeDetails=getNodeDetails(clickedClusters.at(-1),collection),nodeCachedPage=getNodePageNumberFromCache(currentNodeDetails.type,currentNodeDetails.id);setCurrentPage(nodeCachedPage);const extraBackNodes=originalClickedAmount-skip;return extraBackNodes<0&&setLocalRefreshToken((current=>(-1===extraBackNodes?(setCurrentMetaGroup(metaGroupClicked?.key??"text"),setMetaGroupClicked(null)):(setMetaGroupClicked(null),setCurrentMetaGroup("text")),current.length>2?"1":current+"1"))),[...clickedClusters]})):"text"!==currentMetaGroup&&(setMetaGroupClicked(null),setCurrentMetaGroup("text"))},currentPage,totalPagesAmount:totalPages,nextPageClicked:()=>setCurrentPage((page=>page+1)),prevPageClicked:()=>setCurrentPage((page=>page-1)),loading,error,nodesPath:[{text:collectionDisplayName},...metaGroupClicked?[{text:metaGroupClicked.key},{text:metaGroupClicked.value??""}]:[],...clickedNodes.map((node=>{const{originalText,translatedText}=getNodeOriginalAndTranslatedText(node);return{text:originalText??getNodeText(node),translated:translatedText}}))],dateRangeChanged:(from,to)=>setLocalRefreshToken((current=>(setDateRange([from,to]),current+"1"))),labelsFilters,setLabelsFilters,labelClicked:(key,value)=>{labelsFilters.some((keyValue=>keyValue.key.toLowerCase()===key.toLowerCase()&&keyValue.value?.toLowerCase()===value.toLowerCase()))||setLocalRefreshToken((current=>(setLabelsFilters((labels=>[...labels,{key,value}])),current.length>2?"1":current+"1")))},labelFilterDeleted:i=>setLocalRefreshToken((current=>(setLabelsFilters((filters=>(filters.splice(i,1),[...filters]))),current.length>2?"1":current+"1"))),trendPeriods,trendPeriodsChanged:newTrendPeriod=>setLocalRefreshToken((current=>(setTrendPeriods(newTrendPeriod),current+"1"))),searchSimilarClusters:(text,controller)=>async function searchSimilarClusters(controller,domain,collection,apiKey,text){try{const res=await fetch(`${domain}/clustering/v1/collections/${collection}/clusters/find?text=${text}&translate=true`,{method:"GET",headers:{"Content-Type":"application/json","api-key":apiKey},signal:controller.signal});if(200!==res.status||!res.ok)return[];const clusters=await res.json();return clusters&&0!==clusters.length?clusters.sort(((c1,c2)=>c2.similarity-c1.similarity)).map((c=>({id:c.cluster_id,text:c.cluster_text,translation:c.item_translated_text}))):[]}catch(e){return console.error("error occurred ->",e),[]}}(controller,domain,collection,apiKey,text),splitPhrase:(phraseId,controller)=>async function splitPhrase(controller,domain,collection,apiKey,phraseId,setLocalRefreshToken){try{const res=await fetch(`${domain}/clustering/v1/collections/${collection}/phrases/${phraseId}/split`,{method:"POST",headers:{"Content-Type":"application/json","api-key":apiKey},signal:controller.signal});if(200!==res.status||!res.ok)return{status:"error",message:"unknown"};const json=await res.json();return json.message||setLocalRefreshToken((current=>current.length>5?"":current+"1")),json}catch(e){return console.error("error occurred ->",e),{status:"error",message:String(e)}}}(controller,domain,collection,apiKey,phraseId,setLocalRefreshToken),mergeClusters:(source,destination,controller)=>async function mergeClusters(controller,domain,collection,apiKey,source,destination,setLocalRefreshToken){try{const res=await fetch(`${domain}/clustering/v1/collections/${collection}/merge`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","api-key":apiKey},body:JSON.stringify({source_clusters:source,destination_cluster:destination}),signal:controller.signal});if(200!==res.status||!res.ok)return{status:"error",message:"unknown"};const json=await res.json();return json.message||setLocalRefreshToken((current=>current.length>5?"":current+"1")),json}catch(e){return console.error("error occurred ->",e),{status:"error",message:String(e)}}}(controller,domain,collection,apiKey,source,destination,setLocalRefreshToken),toggleHide:(node,hide)=>async function toggleHide(domain,collection,apiKey,node,hide,currentClickedNode,setLocalRefreshToken){if(!node)return;try{const clusterId="Cluster"===node.type?node.id:getNodeId(currentClickedNode),res=await fetch(`${domain}/clustering/v1/collections/${collection}/clusters/${clusterId}${"Phrase"===node.type?`/phrases/${node.id}`:""}/settings`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","api-key":apiKey},body:JSON.stringify({properties:{hide}})});if(200!==res.status||!res.ok)return;setLocalRefreshToken((current=>current.length>5?"":current+"1"))}catch(e){console.error("error occurred ->",e)}}(domain,collection,apiKey,node,hide,clickedNodes.at(-1),setLocalRefreshToken),propertiesFilters,setPropertiesFilters:properties=>setLocalRefreshToken((current=>(setPropertiesFilters(properties),current.length>2?"1":current+"1"))),metaOptions:["text",...uniqBy(metaOptions,(m=>m.toLowerCase()))],currentMetaOption:currentMetaGroup,metaOptionsChanged:metaOptions=>setCurrentMetaGroup(metaOptions),refresh:()=>setLocalRefreshToken((current=>current.length>2?"1":current+"1")),customizeEnabled,datePickerEnabled,startDate,endDate,uniqueMetaKey:uniquePropertyName,filterOnlySkills,...rest}):null};async function fetchMetaClustersApi(controller,domain,collection,apiKey,page,from,to,labelsFilters,trendPeriods,propertiesFilters,metaGroup){return await fetchApi(controller,`${domain}/clustering/v1/collections/${collection}/metadata${metaGroup?`/${metaGroup}`:""}`,apiKey,"content",page,from,to,labelsFilters,trendPeriods,propertiesFilters,"&group-by-meta-value=true"+(metaGroup?"&include-metadata=true":""),1e3)}async function fetchApi(controller,url,apiKey,accessor,page,from,to,labelsFilters,trendPeriods,propertiesFilters,extraParams,limit){const labelsFiltersString=labelsFilters.map((metadataKeyValue=>metadataKeyValue.key&&metadataKeyValue.value?`'${metadataKeyValue.key}' eq '${metadataKeyValue.value}'`:"")).filter((str=>""!==str)),propertiesFiltersString=Object.keys(propertiesFilters).map((key=>{const value=propertiesFilters[key];return value?`'${key}' neq '${value}'`:""}));try{const res=await fetch(encodeURI(`${url}?page=${page}&limit=${void 0!==limit?limit:PAGE_SIZE}&translate=true`+(from?`&from-date=${(0,format.Z)(from,"yyyy-MM-dd")}`:"")+(to?`&to-date=${(0,format.Z)(to,"yyyy-MM-dd")}`:"")+(labelsFiltersString.length>0?`&item-metadata=${labelsFiltersString.join(" and ")}`:"")+(trendPeriods>1?`&include-trends=true&trend-periods-limit=${trendPeriods}`:"")+(propertiesFiltersString.length>0?`&properties-query=${propertiesFiltersString.join(" and ")}`:"")+(extraParams||"")),{method:"GET",headers:{"Content-Type":"application/json","api-key":apiKey},signal:controller.signal});if(200!==res.status||!res.ok)return{totalPages:0,totalItems:0,data:[],error:"Error fetching data, status: "+res.status+": "+await res.text()};const json=await res.json();return{totalPages:json.total_pages,totalItems:json.total_items,uniqueItemsStats:json.total_metadata_stats,data:json[accessor],error:null}}catch(e){const error=String(e);return console.error("error occurred ->",error),{totalPages:0,totalItems:0,data:[],error:`Error fetching data, ${error}`}}}function getNodesFromCache(parentType,parentId,page){const cached=cache.get(assembleCacheId(parentType,parentId,page));return cached&&function getSecondsDiff(startDate,endDate){const diff=endDate.getTime()-startDate.getTime();return Math.abs(diff/1e3)}(cached.time,new Date)<90?cached:null}function setNodesDataInCache(parentType,parentId,page,nodes,totalPages,totalItems,uniqueItemsStats){cache.set(assembleCacheId(parentType,parentId,page),{nodes,totalPages,time:new Date,totalItems,uniqueItemsStats})}function getNodePageNumberFromCache(nodeType,nodeId){const cached=nodeToPageCache.get(assembleCacheId(nodeType,nodeId));return cached||0}function assembleCacheId(type,id,page=0){return`${type}-${id}-${page}`}try{OneAIAnalyticsApiWrapper.displayName="OneAIAnalyticsApiWrapper",OneAIAnalyticsApiWrapper.__docgenInfo={description:"One AI Analytics api wrapper component",displayName:"OneAIAnalyticsApiWrapper",props:{domain:{defaultValue:{value:"prod"},description:"",name:"domain",required:!1,type:{name:"string"}},apiKey:{defaultValue:{value:""},description:"",name:"apiKey",required:!1,type:{name:"string"}},collection:{defaultValue:{value:""},description:"",name:"collection",required:!1,type:{name:"string"}},collectionDisplayName:{defaultValue:{value:""},description:"",name:"collectionDisplayName",required:!1,type:{name:"string"}},refreshToken:{defaultValue:{value:""},description:"",name:"refreshToken",required:!1,type:{name:"string"}},darkMode:{defaultValue:null,description:"",name:"darkMode",required:!1,type:{name:"boolean"}},background:{defaultValue:null,description:"",name:"background",required:!1,type:{name:"string"}},treemapBigColor:{defaultValue:null,description:"",name:"treemapBigColor",required:!1,type:{name:"string"}},treemapSmallColor:{defaultValue:null,description:"",name:"treemapSmallColor",required:!1,type:{name:"string"}},treemapCountFontSize:{defaultValue:null,description:"",name:"treemapCountFontSize",required:!1,type:{name:"number"}},fontFamily:{defaultValue:null,description:"",name:"fontFamily",required:!1,type:{name:"string"}},textColor:{defaultValue:null,description:"",name:"textColor",required:!1,type:{name:"string"}},treemapBorderWidth:{defaultValue:null,description:"",name:"treemapBorderWidth",required:!1,type:{name:"number"}},treemapBorderColor:{defaultValue:null,description:"",name:"treemapBorderColor",required:!1,type:{name:"string"}},navbarColor:{defaultValue:null,description:"",name:"navbarColor",required:!1,type:{name:"string"}},barColor:{defaultValue:null,description:"",name:"barColor",required:!1,type:{name:"string"}},translationEnabled:{defaultValue:null,description:"",name:"translationEnabled",required:!1,type:{name:"boolean"}},customizeEnabled:{defaultValue:{value:"true"},description:"",name:"customizeEnabled",required:!1,type:{name:"boolean"}},filterOnlySkills:{defaultValue:{value:"false"},description:"",name:"filterOnlySkills",required:!1,type:{name:"boolean"}},datePickerEnabled:{defaultValue:{value:"true"},description:"",name:"datePickerEnabled",required:!1,type:{name:"boolean"}},startDate:{defaultValue:{value:"undefined"},description:"",name:"startDate",required:!1,type:{name:"string"}},endDate:{defaultValue:{value:"undefined"},description:"",name:"endDate",required:!1,type:{name:"string"}},uniqueMetaKey:{defaultValue:null,description:"",name:"uniqueMetaKey",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/wrappers/OneAIAnalyticsApiWrapper.tsx#OneAIAnalyticsApiWrapper"]={docgenInfo:OneAIAnalyticsApiWrapper.__docgenInfo,name:"OneAIAnalyticsApiWrapper",path:"src/wrappers/OneAIAnalyticsApiWrapper.tsx#OneAIAnalyticsApiWrapper"})}catch(__react_docgen_typescript_loader_error){}const Analytics_stories={title:"Analytics",component:OneAIAnalyticsApiWrapper,parameters:{controls:{expanded:!0}}},Template={render:args=>(0,jsx_runtime.jsx)("div",{className:"h-screen w-full",children:(0,jsx_runtime.jsx)(OneAIAnalyticsApiWrapper,{...args})})};Template.parameters={...Template.parameters,docs:{...Template.parameters?.docs,source:{originalSource:'{\n  render: args => <div className="h-screen w-full">\n      <OneAIAnalyticsApiWrapper {...args} />\n    </div>\n}',...Template.parameters?.docs?.source}}};const __namedExportsOrder=["Template"]},"./src/common/utils/externalInputs.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{q:()=>resolveDomain});const resolveDomain=userInputDomain=>userInputDomain?userInputDomain.startsWith("http")?userInputDomain:"prod"===userInputDomain?"https://api.oneai.com":"staging"===userInputDomain?"https://staging.oneai.com":`https://${userInputDomain}`:"https://api.oneai.com"}}]);